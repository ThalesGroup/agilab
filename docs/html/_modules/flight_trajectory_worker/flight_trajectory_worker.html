

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>flight_trajectory_worker.flight_trajectory_worker &mdash; AGILab 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=28052664" />

  
    <link rel="canonical" href="https://thalesgroup.github.io/agilab/_modules/flight_trajectory_worker/flight_trajectory_worker.html" />
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=8d563738"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            AGILab
              <img src="../../_static/agi_logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../quick-start.html">Quick-Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../quick-start.html#license">LICENSE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quick-start.html#install-agilab">Install Agilab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quick-start.html#support">Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#purpose"><strong>Purpose</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#target-audience"><strong>Target Audience</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#main-dependencies"><strong>Main Dependencies</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#technologies-selection-criteria"><strong>Technologies Selection Criteria</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#example-aircraft-telecommunication">Example: Aircraft Telecommunication</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../features.html">Features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../features.html#agi-core">agi-core</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../features.html#agilab">agilab</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Core Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cluster.html">Cluster</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../cluster-help.html">Cluster Help</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../cluster-help.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cluster-help.html#principle">Principle</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../key-generation.html">Key Generation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../key-generation.html#generate-the-keys">1. Generate the keys</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../key-generation.html#loading-the-private-key-in-ssh-agent">2. Loading the private key in SSH Agent</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../key-generation.html#load-the-private-key">2.1 Load the private key</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../key-generation.html#verify-the-key-addition">2.2 Verify the key Addition</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../key-generation.html#copy-the-public-key-to-the-server">3. Copy the public key to the server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../key-generation.html#allow-your-key">3.1 Allow your key</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../key-generation.html#verification">3.2 Verification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../key-generation.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../key-generation.html#sshd-service">SSHD Service</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../key-generation.html#useful-links">Useful links</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../agilab.html">AGILab</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../edit_help.html">▶️ EDIT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../edit_help.html#sidebar">Sidebar</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../edit_help.html#main-content-area">Main Content Area</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../edit_help.html#support">Support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../execute_help.html">▶️ EXECUTE</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../execute_help.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../execute_help.html#sidebar">Sidebar</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../execute_help.html#main-content-area">Main Content Area</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../experiment_help.html">▶️ EXPERIMENT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../experiment_help.html#sidebar">Sidebar</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../experiment_help.html#main-content-area">Main Content Area</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../views_help.html">▶️ VIEW</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../views_help.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../views_help.html#sidebar">Sidebar</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../views_help.html#main-content-area">Main Content Area</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../framework-api.html">Framework API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../agi-env.html">agi_env API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../agi-env.html#usage-example">Usage Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../agi-env.html#instanciation">Instanciation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../agi-env.html#reference">Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../agi-env.html#agi_env.agi_env.AgiEnv"><code class="docutils literal notranslate"><span class="pre">AgiEnv</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../agi-env.html#agi_env.agi_env.ContentRenamer"><code class="docutils literal notranslate"><span class="pre">ContentRenamer</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../agi-env.html#agi_env.agi_env.normalize_path"><code class="docutils literal notranslate"><span class="pre">normalize_path()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../agi-runner.html">agi_distributor API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../agi-runner.html#usage-example">Usage Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../agi-runner.html#installation">Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../agi-runner.html#update">Update</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../agi-runner.html#distribute">Distribute</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../agi-runner.html#run">Run</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../agi-runner.html#reference">Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../agi-runner.html#agi_distributor.agi_distributor.AGI"><code class="docutils literal notranslate"><span class="pre">AGI</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../workers.html">workers API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../workers.html#workers-reference">Workers Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../workers.html#agent-worker">agent_worker</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../workers.html#dag-worker">dag_worker</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../workers.html#pandas-worker">pandas_worker</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../workers.html#polars-worker">polars_worker</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../directory-structure.html">Project Files Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install-usecase.html">Installation Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshooting.html#a-prerequisite">A - Prerequisite:</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshooting.html#b-pycharm-run-debug-configurations">B - Pycharm Run/Debug configurations:</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshooting.html#c-exemple-of-tests-sequence">C - Exemple of Tests Sequence:</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshooting.html#d-agilab-run-vs-gui-run">D - agilab_run vs gui_run:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting.html#known-bugs">Known Bugs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshooting.html#uv-sync-failed">&lt;UV&gt; Sync Failed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshooting.html#dask-debug-issue">&lt;DASK&gt; Debug Issue</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshooting.html#pycharm-run-debug-configuration-is-broken">&lt;PYCHARM&gt; Run/Debug Configuration is Broken</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">Licenses</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../gui-licenses.html">Gui Licenses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../node-licenses.html">Node Licenses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../env-licenses.html">Env Licenses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../my-code-project-licenses.html">My-code-project Licenses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flight-project-licenses.html">Flight-project Licenses</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example Projects</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../my-code-project.html">Example1: Mycode-Project</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../my-code-project.html#manager">manager:</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../my-code-project.html#worker-mycode-worker">worker: mycode_worker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker"><code class="docutils literal notranslate"><span class="pre">MycodeWorker</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.algo_A"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.algo_A()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.algo_B"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.algo_B()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.algo_C"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.algo_C()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.algo_X"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.algo_X()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.algo_Y"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.algo_Y()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.algo_Z"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.algo_Z()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.build"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.build()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.cython_decorators"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.cython_decorators</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.dask_home"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.dask_home</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.do_works"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.do_works()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.env"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.env</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.exec"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.exec()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.exec_mono_process"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.exec_mono_process()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.exec_multi_process"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.exec_multi_process()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.expand"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.expand()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.expand_and_join"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.expand_and_join()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.get_logs_and_result"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.get_logs_and_result()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.get_work"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.get_work()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.get_worker_info"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.get_worker_info()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.home_dir"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.home_dir</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.is_managed_pc"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.is_managed_pc</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.join"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.join()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.logs"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.logs</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.mode"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.mode</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.new"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.new()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.onerror"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.onerror()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.share_path"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.share_path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.start"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.start()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.stop"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.stop()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.t0"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.t0</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.test"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.test()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.topological_sort"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.topological_sort()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.verbose"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.verbose</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.worker"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.worker</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.worker_id"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.worker_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../my-code-project.html#mycode_worker.mycode_worker.MycodeWorker.works"><code class="docutils literal notranslate"><span class="pre">MycodeWorker.works()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../flight-project.html">Example2: Flight-Project</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../flight-project.html#manager-flight">manager: flight</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight"><code class="docutils literal notranslate"><span class="pre">Flight</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.__init__"><code class="docutils literal notranslate"><span class="pre">Flight.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.args"><code class="docutils literal notranslate"><span class="pre">Flight.args</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.build"><code class="docutils literal notranslate"><span class="pre">Flight.build()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.build_distribution"><code class="docutils literal notranslate"><span class="pre">Flight.build_distribution()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.cython_decorators"><code class="docutils literal notranslate"><span class="pre">Flight.cython_decorators</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.dask_home"><code class="docutils literal notranslate"><span class="pre">Flight.dask_home</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.data_out"><code class="docutils literal notranslate"><span class="pre">Flight.data_out</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.do_works"><code class="docutils literal notranslate"><span class="pre">Flight.do_works()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.env"><code class="docutils literal notranslate"><span class="pre">Flight.env</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.exec"><code class="docutils literal notranslate"><span class="pre">Flight.exec()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.expand"><code class="docutils literal notranslate"><span class="pre">Flight.expand()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.expand_and_join"><code class="docutils literal notranslate"><span class="pre">Flight.expand_and_join()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.extract_plane_from_file_name"><code class="docutils literal notranslate"><span class="pre">Flight.extract_plane_from_file_name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.get_data_from_files"><code class="docutils literal notranslate"><span class="pre">Flight.get_data_from_files()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.get_data_from_hawk"><code class="docutils literal notranslate"><span class="pre">Flight.get_data_from_hawk()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.get_logs_and_result"><code class="docutils literal notranslate"><span class="pre">Flight.get_logs_and_result()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.get_partition_by_planes"><code class="docutils literal notranslate"><span class="pre">Flight.get_partition_by_planes()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.get_worker_info"><code class="docutils literal notranslate"><span class="pre">Flight.get_worker_info()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.home_dir"><code class="docutils literal notranslate"><span class="pre">Flight.home_dir</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.is_managed_pc"><code class="docutils literal notranslate"><span class="pre">Flight.is_managed_pc</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.ivq_logs"><code class="docutils literal notranslate"><span class="pre">Flight.ivq_logs</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.join"><code class="docutils literal notranslate"><span class="pre">Flight.join()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.logs"><code class="docutils literal notranslate"><span class="pre">Flight.logs</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.mode"><code class="docutils literal notranslate"><span class="pre">Flight.mode</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.new"><code class="docutils literal notranslate"><span class="pre">Flight.new()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.onerror"><code class="docutils literal notranslate"><span class="pre">Flight.onerror()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.share_path"><code class="docutils literal notranslate"><span class="pre">Flight.share_path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.start"><code class="docutils literal notranslate"><span class="pre">Flight.start()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.stop"><code class="docutils literal notranslate"><span class="pre">Flight.stop()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.t0"><code class="docutils literal notranslate"><span class="pre">Flight.t0</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.test"><code class="docutils literal notranslate"><span class="pre">Flight.test()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.verbose"><code class="docutils literal notranslate"><span class="pre">Flight.verbose</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.worker"><code class="docutils literal notranslate"><span class="pre">Flight.worker</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.Flight.worker_id"><code class="docutils literal notranslate"><span class="pre">Flight.worker_id</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs"><code class="docutils literal notranslate"><span class="pre">FlightArgs</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.__init__"><code class="docutils literal notranslate"><span class="pre">FlightArgs.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.check_date"><code class="docutils literal notranslate"><span class="pre">FlightArgs.check_date()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.check_date_order"><code class="docutils literal notranslate"><span class="pre">FlightArgs.check_date_order()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.check_valid_regex"><code class="docutils literal notranslate"><span class="pre">FlightArgs.check_valid_regex()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.construct"><code class="docutils literal notranslate"><span class="pre">FlightArgs.construct()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.copy"><code class="docutils literal notranslate"><span class="pre">FlightArgs.copy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.data_source"><code class="docutils literal notranslate"><span class="pre">FlightArgs.data_source</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.datemax"><code class="docutils literal notranslate"><span class="pre">FlightArgs.datemax</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.datemin"><code class="docutils literal notranslate"><span class="pre">FlightArgs.datemin</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.dict"><code class="docutils literal notranslate"><span class="pre">FlightArgs.dict()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.files"><code class="docutils literal notranslate"><span class="pre">FlightArgs.files</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.from_orm"><code class="docutils literal notranslate"><span class="pre">FlightArgs.from_orm()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.json"><code class="docutils literal notranslate"><span class="pre">FlightArgs.json()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.model_computed_fields"><code class="docutils literal notranslate"><span class="pre">FlightArgs.model_computed_fields</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.model_config"><code class="docutils literal notranslate"><span class="pre">FlightArgs.model_config</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.model_construct"><code class="docutils literal notranslate"><span class="pre">FlightArgs.model_construct()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.model_copy"><code class="docutils literal notranslate"><span class="pre">FlightArgs.model_copy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.model_dump"><code class="docutils literal notranslate"><span class="pre">FlightArgs.model_dump()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.model_dump_json"><code class="docutils literal notranslate"><span class="pre">FlightArgs.model_dump_json()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.model_extra"><code class="docutils literal notranslate"><span class="pre">FlightArgs.model_extra</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.model_fields"><code class="docutils literal notranslate"><span class="pre">FlightArgs.model_fields</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.model_fields_set"><code class="docutils literal notranslate"><span class="pre">FlightArgs.model_fields_set</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.model_json_schema"><code class="docutils literal notranslate"><span class="pre">FlightArgs.model_json_schema()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.model_parametrized_name"><code class="docutils literal notranslate"><span class="pre">FlightArgs.model_parametrized_name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.model_post_init"><code class="docutils literal notranslate"><span class="pre">FlightArgs.model_post_init()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.model_rebuild"><code class="docutils literal notranslate"><span class="pre">FlightArgs.model_rebuild()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.model_validate"><code class="docutils literal notranslate"><span class="pre">FlightArgs.model_validate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.model_validate_json"><code class="docutils literal notranslate"><span class="pre">FlightArgs.model_validate_json()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.model_validate_strings"><code class="docutils literal notranslate"><span class="pre">FlightArgs.model_validate_strings()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.nfile"><code class="docutils literal notranslate"><span class="pre">FlightArgs.nfile</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.nread"><code class="docutils literal notranslate"><span class="pre">FlightArgs.nread</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.nskip"><code class="docutils literal notranslate"><span class="pre">FlightArgs.nskip</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.output_format"><code class="docutils literal notranslate"><span class="pre">FlightArgs.output_format</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.parse_file"><code class="docutils literal notranslate"><span class="pre">FlightArgs.parse_file()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.parse_obj"><code class="docutils literal notranslate"><span class="pre">FlightArgs.parse_obj()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.parse_raw"><code class="docutils literal notranslate"><span class="pre">FlightArgs.parse_raw()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.path"><code class="docutils literal notranslate"><span class="pre">FlightArgs.path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.sampling_rate"><code class="docutils literal notranslate"><span class="pre">FlightArgs.sampling_rate</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.schema"><code class="docutils literal notranslate"><span class="pre">FlightArgs.schema()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.schema_json"><code class="docutils literal notranslate"><span class="pre">FlightArgs.schema_json()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.update_forward_refs"><code class="docutils literal notranslate"><span class="pre">FlightArgs.update_forward_refs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight.flight.FlightArgs.validate"><code class="docutils literal notranslate"><span class="pre">FlightArgs.validate()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../flight-project.html#worker-flight-worker">worker: flight_worker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker"><code class="docutils literal notranslate"><span class="pre">FlightWorker</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.build"><code class="docutils literal notranslate"><span class="pre">FlightWorker.build()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.calculate_speed"><code class="docutils literal notranslate"><span class="pre">FlightWorker.calculate_speed()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.cython_decorators"><code class="docutils literal notranslate"><span class="pre">FlightWorker.cython_decorators</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.dask_home"><code class="docutils literal notranslate"><span class="pre">FlightWorker.dask_home</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.do_works"><code class="docutils literal notranslate"><span class="pre">FlightWorker.do_works()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.env"><code class="docutils literal notranslate"><span class="pre">FlightWorker.env</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.exec"><code class="docutils literal notranslate"><span class="pre">FlightWorker.exec()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.exec_mono_process"><code class="docutils literal notranslate"><span class="pre">FlightWorker.exec_mono_process()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.exec_multi_process"><code class="docutils literal notranslate"><span class="pre">FlightWorker.exec_multi_process()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.expand"><code class="docutils literal notranslate"><span class="pre">FlightWorker.expand()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.expand_and_join"><code class="docutils literal notranslate"><span class="pre">FlightWorker.expand_and_join()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.get_logs_and_result"><code class="docutils literal notranslate"><span class="pre">FlightWorker.get_logs_and_result()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.get_worker_info"><code class="docutils literal notranslate"><span class="pre">FlightWorker.get_worker_info()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.home_dir"><code class="docutils literal notranslate"><span class="pre">FlightWorker.home_dir</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.is_managed_pc"><code class="docutils literal notranslate"><span class="pre">FlightWorker.is_managed_pc</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.join"><code class="docutils literal notranslate"><span class="pre">FlightWorker.join()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.logs"><code class="docutils literal notranslate"><span class="pre">FlightWorker.logs</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.mode"><code class="docutils literal notranslate"><span class="pre">FlightWorker.mode</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.new"><code class="docutils literal notranslate"><span class="pre">FlightWorker.new()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.onerror"><code class="docutils literal notranslate"><span class="pre">FlightWorker.onerror()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.pool_init"><code class="docutils literal notranslate"><span class="pre">FlightWorker.pool_init()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.pool_vars"><code class="docutils literal notranslate"><span class="pre">FlightWorker.pool_vars</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.preprocess_df"><code class="docutils literal notranslate"><span class="pre">FlightWorker.preprocess_df()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.share_path"><code class="docutils literal notranslate"><span class="pre">FlightWorker.share_path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.start"><code class="docutils literal notranslate"><span class="pre">FlightWorker.start()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.stop"><code class="docutils literal notranslate"><span class="pre">FlightWorker.stop()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.t0"><code class="docutils literal notranslate"><span class="pre">FlightWorker.t0</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.test"><code class="docutils literal notranslate"><span class="pre">FlightWorker.test()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.verbose"><code class="docutils literal notranslate"><span class="pre">FlightWorker.verbose</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.work_done"><code class="docutils literal notranslate"><span class="pre">FlightWorker.work_done()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.work_init"><code class="docutils literal notranslate"><span class="pre">FlightWorker.work_init()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.work_pool"><code class="docutils literal notranslate"><span class="pre">FlightWorker.work_pool()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.worker"><code class="docutils literal notranslate"><span class="pre">FlightWorker.worker</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.worker_id"><code class="docutils literal notranslate"><span class="pre">FlightWorker.worker_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-project.html#flight_worker.flight_worker.FlightWorker.works"><code class="docutils literal notranslate"><span class="pre">FlightWorker.works()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../flight-trajectory.html">Example3: Flight-Trajectory-Project</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../flight-trajectory.html#manager-flight-trjectory">manager: flight_trjectory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.__init__"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.build"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.build()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.build_distribution"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.build_distribution()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.cython_decorators"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.cython_decorators</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.dask_home"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.dask_home</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.do_works"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.do_works()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.env"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.env</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.exec"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.exec()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.expand"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.expand()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.expand_and_join"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.expand_and_join()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.get_logs_and_result"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.get_logs_and_result()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.get_worker_info"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.get_worker_info()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.haversine"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.haversine()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.home_dir"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.home_dir</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.is_managed_pc"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.is_managed_pc</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.ivq_logs"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.ivq_logs</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.join"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.join()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.logs"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.logs</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.mode"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.mode</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.new"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.new()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.onerror"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.onerror()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.share_path"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.share_path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.start"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.start()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.stop"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.stop()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.t0"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.t0</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.test"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.test()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.verbose"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.verbose</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.waypoints"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.waypoints</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.worker"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.worker</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectory.worker_id"><code class="docutils literal notranslate"><span class="pre">FlightTrajectory.worker_id</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.__init__"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.beam_file"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.beam_file</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.construct"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.construct()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.copy"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.copy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.data_dir"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.data_dir</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.data_out"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.data_out</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.dict"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.dict()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.flight_id"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.flight_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.from_orm"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.from_orm()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.json"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.json()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.model_computed_fields"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.model_computed_fields</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.model_config"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.model_config</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.model_construct"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.model_construct()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.model_copy"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.model_copy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.model_dump"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.model_dump()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.model_dump_json"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.model_dump_json()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.model_extra"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.model_extra</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.model_fields"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.model_fields</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.model_fields_set"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.model_fields_set</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.model_json_schema"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.model_json_schema()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.model_parametrized_name"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.model_parametrized_name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.model_post_init"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.model_post_init()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.model_rebuild"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.model_rebuild()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.model_validate"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.model_validate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.model_validate_json"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.model_validate_json()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.model_validate_strings"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.model_validate_strings()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.parse_file"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.parse_file()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.parse_obj"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.parse_obj()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.parse_raw"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.parse_raw()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.path"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.sat_file"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.sat_file</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.schema"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.schema()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.schema_json"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.schema_json()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.update_forward_refs"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.update_forward_refs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.validate"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.validate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory.flight_trajectory.FlightTrajectoryArgs.waypoints"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryArgs.waypoints</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../flight-trajectory.html#worker-flight-trajectory-worker">worker: flight_trajectory_worker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.build"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.build()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.cython_decorators"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.cython_decorators</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.dask_home"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.dask_home</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.do_works"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.do_works()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.env"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.env</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.exec"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.exec()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.exec_mono_process"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.exec_mono_process()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.exec_multi_process"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.exec_multi_process()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.expand"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.expand()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.expand_and_join"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.expand_and_join()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.get_logs_and_result"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.get_logs_and_result()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.get_worker_info"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.get_worker_info()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.home_dir"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.home_dir</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.is_managed_pc"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.is_managed_pc</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.join"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.join()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.logs"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.logs</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.mode"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.mode</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.new"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.new()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.onerror"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.onerror()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.pool_init"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.pool_init()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.pool_vars"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.pool_vars</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.share_path"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.share_path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.start"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.start()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.stop"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.stop()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.t0"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.t0</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.test"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.test()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.verbose"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.verbose</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.work_done"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.work_done()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.work_init"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.work_init()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.work_pool"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.work_pool()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.worker"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.worker</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.worker_id"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.worker_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.works"><code class="docutils literal notranslate"><span class="pre">FlightTrajectoryWorker.works()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.haversine"><code class="docutils literal notranslate"><span class="pre">haversine()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory"><code class="docutils literal notranslate"><span class="pre">plane_trajectory</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.__init__"><code class="docutils literal notranslate"><span class="pre">plane_trajectory.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.calculate_bearing"><code class="docutils literal notranslate"><span class="pre">plane_trajectory.calculate_bearing()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.calculate_trajectory"><code class="docutils literal notranslate"><span class="pre">plane_trajectory.calculate_trajectory()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.calculate_turn_direction_and_angle"><code class="docutils literal notranslate"><span class="pre">plane_trajectory.calculate_turn_direction_and_angle()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.cruise_to_destination"><code class="docutils literal notranslate"><span class="pre">plane_trajectory.cruise_to_destination()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.df_col_names"><code class="docutils literal notranslate"><span class="pre">plane_trajectory.df_col_names</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.estimate_altitude_change_for_pitch_correction"><code class="docutils literal notranslate"><span class="pre">plane_trajectory.estimate_altitude_change_for_pitch_correction()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.estimate_descent_distance"><code class="docutils literal notranslate"><span class="pre">plane_trajectory.estimate_descent_distance()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.estimate_level_off_alt_gain"><code class="docutils literal notranslate"><span class="pre">plane_trajectory.estimate_level_off_alt_gain()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.estimate_roll_pitch_correction_rotation"><code class="docutils literal notranslate"><span class="pre">plane_trajectory.estimate_roll_pitch_correction_rotation()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.get_min_waypoints_distance"><code class="docutils literal notranslate"><span class="pre">plane_trajectory.get_min_waypoints_distance()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.haversine_distance"><code class="docutils literal notranslate"><span class="pre">plane_trajectory.haversine_distance()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.perform_descent"><code class="docutils literal notranslate"><span class="pre">plane_trajectory.perform_descent()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.perform_pitch_correction_to_level"><code class="docutils literal notranslate"><span class="pre">plane_trajectory.perform_pitch_correction_to_level()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.perform_roll_pitch_correction"><code class="docutils literal notranslate"><span class="pre">plane_trajectory.perform_roll_pitch_correction()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.perform_turn_to_next_waypoint"><code class="docutils literal notranslate"><span class="pre">plane_trajectory.perform_turn_to_next_waypoint()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.plot"><code class="docutils literal notranslate"><span class="pre">plane_trajectory.plot()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.plot_3d_flight_path"><code class="docutils literal notranslate"><span class="pre">plane_trajectory.plot_3d_flight_path()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.simulate_cruise_to_waypoint"><code class="docutils literal notranslate"><span class="pre">plane_trajectory.simulate_cruise_to_waypoint()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.simulate_takeoff_and_climb"><code class="docutils literal notranslate"><span class="pre">plane_trajectory.simulate_takeoff_and_climb()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../link-sim.html">Example4: Link-Sim-Project</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../link-sim.html#manager-link-sim">manager: link_sim</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim"><code class="docutils literal notranslate"><span class="pre">LinkSim</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.__init__"><code class="docutils literal notranslate"><span class="pre">LinkSim.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.build"><code class="docutils literal notranslate"><span class="pre">LinkSim.build()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.build_distribution"><code class="docutils literal notranslate"><span class="pre">LinkSim.build_distribution()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.cython_decorators"><code class="docutils literal notranslate"><span class="pre">LinkSim.cython_decorators</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.dask_home"><code class="docutils literal notranslate"><span class="pre">LinkSim.dask_home</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.do_works"><code class="docutils literal notranslate"><span class="pre">LinkSim.do_works()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.env"><code class="docutils literal notranslate"><span class="pre">LinkSim.env</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.exec"><code class="docutils literal notranslate"><span class="pre">LinkSim.exec()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.expand"><code class="docutils literal notranslate"><span class="pre">LinkSim.expand()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.expand_and_join"><code class="docutils literal notranslate"><span class="pre">LinkSim.expand_and_join()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.get_logs_and_result"><code class="docutils literal notranslate"><span class="pre">LinkSim.get_logs_and_result()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.get_worker_info"><code class="docutils literal notranslate"><span class="pre">LinkSim.get_worker_info()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.home_dir"><code class="docutils literal notranslate"><span class="pre">LinkSim.home_dir</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.is_managed_pc"><code class="docutils literal notranslate"><span class="pre">LinkSim.is_managed_pc</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.join"><code class="docutils literal notranslate"><span class="pre">LinkSim.join()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.logs"><code class="docutils literal notranslate"><span class="pre">LinkSim.logs</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.mode"><code class="docutils literal notranslate"><span class="pre">LinkSim.mode</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.new"><code class="docutils literal notranslate"><span class="pre">LinkSim.new()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.onerror"><code class="docutils literal notranslate"><span class="pre">LinkSim.onerror()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.plane_conf_path"><code class="docutils literal notranslate"><span class="pre">LinkSim.plane_conf_path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.share_path"><code class="docutils literal notranslate"><span class="pre">LinkSim.share_path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.start"><code class="docutils literal notranslate"><span class="pre">LinkSim.start()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.stop"><code class="docutils literal notranslate"><span class="pre">LinkSim.stop()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.t0"><code class="docutils literal notranslate"><span class="pre">LinkSim.t0</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.test"><code class="docutils literal notranslate"><span class="pre">LinkSim.test()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.verbose"><code class="docutils literal notranslate"><span class="pre">LinkSim.verbose</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.worker"><code class="docutils literal notranslate"><span class="pre">LinkSim.worker</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSim.worker_id"><code class="docutils literal notranslate"><span class="pre">LinkSim.worker_id</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.__init__"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.construct"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.construct()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.copy"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.copy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.data_dir"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.data_dir</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.data_flight"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.data_flight</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.data_out"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.data_out</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.data_sat"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.data_sat</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.dict"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.dict()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.from_orm"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.from_orm()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.json"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.json()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.model_computed_fields"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.model_computed_fields</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.model_config"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.model_config</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.model_construct"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.model_construct()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.model_copy"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.model_copy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.model_dump"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.model_dump()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.model_dump_json"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.model_dump_json()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.model_extra"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.model_extra</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.model_fields"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.model_fields</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.model_fields_set"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.model_fields_set</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.model_json_schema"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.model_json_schema()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.model_parametrized_name"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.model_parametrized_name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.model_post_init"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.model_post_init()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.model_rebuild"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.model_rebuild()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.model_validate"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.model_validate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.model_validate_json"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.model_validate_json()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.model_validate_strings"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.model_validate_strings()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.parse_file"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.parse_file()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.parse_obj"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.parse_obj()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.parse_raw"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.parse_raw()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.path"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.plane_conf_path"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.plane_conf_path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.schema"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.schema()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.schema_json"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.schema_json()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.update_forward_refs"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.update_forward_refs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.LinkSimArgs.validate"><code class="docutils literal notranslate"><span class="pre">LinkSimArgs.validate()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.analyze_csvs_in_folder"><code class="docutils literal notranslate"><span class="pre">analyze_csvs_in_folder()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../link-sim.html#link_sim.link_sim.combine_csvs_from_folder"><code class="docutils literal notranslate"><span class="pre">combine_csvs_from_folder()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../link-sim.html#worker-link-sim-worker">worker: link_sim_worker</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hosting Sites</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../agilab-github.html"><strong>Agilab project</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../agilab-github.html#agilab-components"><strong>Agilab components</strong></a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">AGILab</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">flight_trajectory_worker.flight_trajectory_worker</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for flight_trajectory_worker.flight_trajectory_worker</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">getpass</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span> <span class="k">as</span> <span class="n">dt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">polars_worker</span><span class="w"> </span><span class="kn">import</span> <span class="n">PolarsWorker</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">geopy.distance</span><span class="w"> </span><span class="kn">import</span> <span class="n">geodesic</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">geopy.distance</span><span class="w"> </span><span class="kn">import</span> <span class="n">distance</span> <span class="k">as</span> <span class="n">Geodistance</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">geopy.point</span><span class="w"> </span><span class="kn">import</span> <span class="n">Point</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">plotly.express</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">px</span>


<div class="viewcode-block" id="plane_trajectory">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">plane_trajectory</span><span class="p">:</span>
    <span class="n">df_col_names</span> <span class="o">=</span> <span class="p">[</span>  <span class="c1"># Log columns</span>
        <span class="s2">&quot;plane_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time_s&quot;</span><span class="p">,</span>
        <span class="s2">&quot;speed_ms&quot;</span><span class="p">,</span>
        <span class="s2">&quot;alt_m&quot;</span><span class="p">,</span>
        <span class="s2">&quot;roll_deg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pitch_deg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;yaw_deg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bearing_deg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
        <span class="s2">&quot;longitude&quot;</span><span class="p">,</span>
        <span class="s2">&quot;distance&quot;</span><span class="p">,</span>
        <span class="s2">&quot;phase&quot;</span><span class="p">,</span>
        <span class="s2">&quot;plane_type&quot;</span>
    <span class="p">]</span>

<div class="viewcode-block" id="plane_trajectory.__init__">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">flight_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                 <span class="n">waypoints</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9000</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5000</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5000</span><span class="p">)],</span>
                 <span class="n">yaw_angular_speed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">roll_angular_speed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">,</span>
                 <span class="n">pitch_angular_speed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
                 <span class="n">vehicle_acceleration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
                 <span class="n">max_speed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">900.0</span><span class="p">,</span>
                 <span class="n">max_roll</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">30.0</span><span class="p">,</span>
                 <span class="n">max_pitch</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">12.0</span><span class="p">,</span>
                 <span class="n">target_climbup_pitch</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span>
                 <span class="n">pitch_enable_speed_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.30</span><span class="p">,</span>
                 <span class="n">altitude_loss_speed_treshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">400.0</span><span class="p">,</span>
                 <span class="n">landing_speed_target</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">200.0</span><span class="p">,</span>
                 <span class="n">descent_pitch_target</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span>
                 <span class="n">landing_pitch_target</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
                 <span class="n">cruising_pitch_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
                 <span class="n">descent_alt_treshold_landing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
                 <span class="n">max_speed_ratio_while_turining</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
                 <span class="n">enable_climb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">enable_descent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">default_alt_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4000.0</span><span class="p">,</span>
                 <span class="n">plane_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;classique_plane&quot;</span>
                 <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roll</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yaw</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_climb</span> <span class="o">=</span> <span class="n">enable_climb</span>  <span class="c1"># enable the scenario where the plane climb up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_descent</span> <span class="o">=</span> <span class="n">enable_descent</span>  <span class="c1"># enable the scenario where the plane descent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flight_id</span> <span class="o">=</span> <span class="n">flight_id</span>  <span class="c1"># the ID of the flight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span> <span class="o">=</span> <span class="n">waypoints</span>  <span class="c1"># list of points to pass</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected at least 2 waypoints, but got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Expected at least 2 coords (lat,lon) but got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="si">}</span><span class="s2"> args at index </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">default_alt_value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yaw_angular_speed</span> <span class="o">=</span> <span class="n">yaw_angular_speed</span>  <span class="c1"># in deg but not used.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roll_angular_speed</span> <span class="o">=</span> <span class="n">roll_angular_speed</span>  <span class="c1"># in deg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span> <span class="o">=</span> <span class="n">pitch_angular_speed</span>  <span class="c1"># in deg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vehicle_acceleration</span> <span class="o">=</span> <span class="n">vehicle_acceleration</span>  <span class="c1"># in m/s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_speed_kmh</span> <span class="o">=</span> <span class="n">max_speed</span>  <span class="c1"># in Km/h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span> <span class="o">=</span> <span class="n">max_speed</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mi">3600</span>  <span class="c1"># in m/s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_altitude_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># in meter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_roll</span> <span class="o">=</span> <span class="n">max_roll</span>  <span class="c1"># in deg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_pitch</span> <span class="o">=</span> <span class="n">max_pitch</span>  <span class="c1"># in deg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cruising_pitch_max</span> <span class="o">=</span> <span class="n">cruising_pitch_max</span>  <span class="c1"># cruising pitch in deg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plane_type</span> <span class="o">=</span> <span class="n">plane_type</span>  <span class="c1"># type of vehicle</span>
        <span class="c1"># --- Pitch Enable Speed ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pitch_enable_speed_ratio</span> <span class="o">=</span> <span class="n">pitch_enable_speed_ratio</span>  <span class="c1"># at what speed (ratio from max speed) does the plane began to climb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pitch_enable_speed_m_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch_enable_speed_ratio</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span>  <span class="c1"># actual speed that the plane is allow to pitch up</span>
        <span class="c1"># --- detect waypoints ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waypoint_arrival_threshold_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># threshold for the passage of the waypoints</span>
        <span class="c1"># --- landing charact ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vehicle_deceleration</span> <span class="o">=</span> <span class="n">vehicle_acceleration</span> <span class="o">*</span> <span class="mf">1.2</span>  <span class="c1"># not editable but give the plane deceleration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">landing_speed_kmh</span> <span class="o">=</span> <span class="n">landing_speed_target</span>  <span class="c1"># speed that we are targetting for the landing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">landing_speed_m_s</span> <span class="o">=</span> <span class="n">landing_speed_target</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mi">3600</span>  <span class="c1"># convert kilometer per seconds to meter per seconds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stall_speed_threshold_kmh</span> <span class="o">=</span> <span class="n">altitude_loss_speed_treshold</span>  <span class="c1"># speed where the plane began to stall, plane lose altitude due to low speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stall_speed_threshold_m_s</span> <span class="o">=</span> <span class="n">altitude_loss_speed_treshold</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mi">3600</span>  <span class="c1"># convert the previous speed from kilometer per seconds to meter per seconds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descent_pitch_target_deg</span> <span class="o">=</span> <span class="n">descent_pitch_target</span>  <span class="c1"># descent pitch target in deg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descent_altitude_threshold_landing_m</span> <span class="o">=</span> <span class="n">descent_alt_treshold_landing</span>  <span class="c1"># give the threshold where the plane prepare for landing (nose pitch up a bit)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">landing_pitch_target_deg</span> <span class="o">=</span> <span class="n">landing_pitch_target</span>  <span class="c1"># the finale pitch (nose up) for the landing in degree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">climb_pitch_target_deg</span> <span class="o">=</span> <span class="n">target_climbup_pitch</span>  <span class="c1"># pitch of the climbup in degree</span>
        <span class="c1"># --- Turning charac ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_speed_ratio_while_turning</span> <span class="o">=</span> <span class="n">max_speed_ratio_while_turining</span>  <span class="c1"># lower speed for turns ratio from max speed eg 0.3 give 0.3*maxspeed</span>
        <span class="c1"># --- init case No climb ---</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">enable_climb</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_bearing</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">2</span><span class="p">]))</span>

        <span class="n">min_distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_min_waypoints_distance</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">waypoints</span><span class="p">)):</span>
            <span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">waypoints</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">lat2</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">waypoints</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

            <span class="n">distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">haversine_distance</span><span class="p">(</span><span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">lat2</span><span class="p">,</span> <span class="n">lon2</span><span class="p">)</span>


            <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">min_distance</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distance between waypoint </span><span class="si">{</span><span class="n">idx</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">distance</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">m&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Waypoints #</span><span class="si">{</span><span class="n">idx</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> and #</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2"> are too close: </span><span class="si">{</span><span class="n">distance</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">m &lt; </span><span class="si">{</span><span class="n">min_distance</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">m, change their positions or decrease the max speed&quot;</span>
                <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;TrajectoryLogger(</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;  time = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="si">}</span><span class="s2"> s</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;  speed = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="si">}</span><span class="s2"> m/s</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;  alt = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alt</span><span class="si">}</span><span class="s2"> m</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;  roll = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="si">}</span><span class="s2">°</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;  pitch = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="si">}</span><span class="s2">°</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;  yaw = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">yaw</span><span class="si">}</span><span class="s2">°</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;  bearing = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing</span><span class="si">}</span><span class="s2">°</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;  coords = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;  waypoints = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;  yaw_angular_speed = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">yaw_angular_speed</span><span class="si">}</span><span class="s2">°/s</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;  roll_angular_speed = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">roll_angular_speed</span><span class="si">}</span><span class="s2">°/s</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;  pitch_angular_speed = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span><span class="si">}</span><span class="s2">°/s</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;  vehicule_acceleration = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vehicle_acceleration</span><span class="si">}</span><span class="s2"> m/s²</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;  max_speed = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_speed_kmh</span><span class="si">}</span><span class="s2"> km/h (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> m/s)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;  Alt_Target = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_altitude_m</span><span class="si">}</span><span class="s2"> m</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;  max_roll = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_roll</span><span class="si">}</span><span class="s2">°</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;  max_pitch = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_pitch</span><span class="si">}</span><span class="s2">°</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;)&quot;</span>
        <span class="p">)</span>

    <span class="fm">__repr__</span> <span class="o">=</span> <span class="fm">__str__</span>

<div class="viewcode-block" id="plane_trajectory.calculate_bearing">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.calculate_bearing">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_bearing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord1</span><span class="p">,</span> <span class="n">coord2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the compass bearing from coord1 to coord2.</span>

<span class="sd">        This function computes the initial bearing (also called forward azimuth) that</span>
<span class="sd">        you would follow from the start coordinate to reach the end coordinate on</span>
<span class="sd">        the Earth&#39;s surface, assuming a spherical Earth model.</span>

<span class="sd">        The bearing is calculated clockwise from the north direction (0° to 360°).</span>

<span class="sd">        Parameters:</span>
<span class="sd">            coord1 (tuple): Latitude and longitude of the start point (degrees).</span>
<span class="sd">            coord2 (tuple): Latitude and longitude of the end point (degrees).</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Bearing angle in degrees from North (0° to 360°).</span>

<span class="sd">        Math:</span>
<span class="sd">            - Converts lat/lon to radians.</span>
<span class="sd">            - Uses spherical trigonometry formulas to compute bearing:</span>
<span class="sd">                x = sin(delta_longitude) * cos(lat2)</span>
<span class="sd">                y = cos(lat1)*sin(lat2) - sin(lat1)*cos(lat2)*cos(delta_longitude)</span>
<span class="sd">            - Bearing = atan2(x, y) converted to degrees and normalized to [0,360).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lat1_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">coord1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">lat2_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">coord2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">diff_long_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">coord2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">coord1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">diff_long_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat2_rad</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat1_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat2_rad</span><span class="p">)</span> <span class="o">-</span>
             <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat1_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat2_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">diff_long_rad</span><span class="p">))</span>

        <span class="n">initial_bearing_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">initial_bearing_deg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">initial_bearing_rad</span><span class="p">)</span>
        <span class="n">compass_bearing</span> <span class="o">=</span> <span class="p">(</span><span class="n">initial_bearing_deg</span> <span class="o">+</span> <span class="mi">360</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span>

        <span class="k">return</span> <span class="n">compass_bearing</span></div>


<div class="viewcode-block" id="plane_trajectory.estimate_level_off_alt_gain">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.estimate_level_off_alt_gain">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">estimate_level_off_alt_gain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate the altitude gained during the aircraft&#39;s pitch reduction phase.</span>

<span class="sd">        This method estimates how much altitude the aircraft will gain while</span>
<span class="sd">        reducing its pitch angle from the current pitch to zero (level flight),</span>
<span class="sd">        assuming constant pitch angular speed and target speed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Estimated altitude gain in meters during leveling off.</span>

<span class="sd">        Math:</span>
<span class="sd">            - Time to level off is current pitch divided by pitch angular speed.</span>
<span class="sd">            - Average pitch during leveling is assumed to be half the initial pitch.</span>
<span class="sd">            - Vertical speed component is target speed * sin(average pitch).</span>
<span class="sd">            - Estimated altitude gain = vertical speed * time to level.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span> <span class="o">&lt;=</span> <span class="mf">1e-6</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">time_to_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span>
        <span class="n">avg_pitch_deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">avg_pitch_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">avg_pitch_deg</span><span class="p">)</span>

        <span class="c1"># Predict using target speed as plane should be near target speed when leveling off</span>
        <span class="n">predict_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span>
        <span class="n">avg_vertical_speed</span> <span class="o">=</span> <span class="n">predict_speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">avg_pitch_rad</span><span class="p">)</span>
        <span class="n">estimated_gain</span> <span class="o">=</span> <span class="n">avg_vertical_speed</span> <span class="o">*</span> <span class="n">time_to_level</span>

        <span class="k">return</span> <span class="n">estimated_gain</span></div>


<div class="viewcode-block" id="plane_trajectory.simulate_takeoff_and_climb">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.simulate_takeoff_and_climb">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">simulate_takeoff_and_climb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">pitch_threshold</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate the aircraft&#39;s takeoff roll, climb phase, and predictive level-off.</span>

<span class="sd">        The simulation uses geographic coordinates (latitude/longitude) and updates</span>
<span class="sd">        aircraft state every dt seconds. It transitions through three phases:</span>
<span class="sd">        - Takeoff Roll: aircraft accelerates on runway with zero pitch.</span>
<span class="sd">        - Climb: aircraft climbs at maximum pitch until near target altitude.</span>
<span class="sd">        - Level Off: aircraft reduces pitch to level flight near target altitude.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            dt (float): Time step for simulation update (seconds).</span>
<span class="sd">            pitch_threshold (float): Pitch angle threshold to consider leveling complete (degrees).</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A DataFrame logging the aircraft state at each time step with</span>
<span class="sd">                columns for time, speed, altitude, roll, pitch, yaw, bearing, position, etc.</span>

<span class="sd">        Math and Logic:</span>
<span class="sd">            - Uses pitch angular speed and vehicle acceleration to update pitch and speed.</span>
<span class="sd">            - Calculates vertical and horizontal speed components from pitch.</span>
<span class="sd">            - Updates geographic position using geopy&#39;s geodesic destination.</span>
<span class="sd">            - Tracks phase transitions based on speed and altitude.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Starting Takeoff Roll, Climb &amp; Predictive Level Off Simulation ---&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using Geographic Coordinates (Lat/Lon). Pitch enabled &gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pitch_enable_speed_m_s</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> m/s&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Target Alt: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_altitude_m</span><span class="si">}</span><span class="s2"> m, Target Speed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> m/s, Max Pitch: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_pitch</span><span class="si">}</span><span class="s2">°&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-----------------------------------------------------------------------&quot;</span><span class="p">)</span>

        <span class="n">log_entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">time_elapsed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="s2">&quot;Takeoff Roll&quot;</span>  <span class="c1"># Start phase</span>
        <span class="n">level_off_initiated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">pitch_enabled</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Flag: can pitch yet?</span>

        <span class="c1"># Set initial bearing toward next checkpoint</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_bearing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span>  <span class="c1"># Assume instant runway alignment</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initial bearing calculated using class method: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">°&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Only one checkpoint. Cannot calculate bearing. Setting to 0.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yaw</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">predicted_altitude_gain</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">trigger_altitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_altitude_m</span>  <span class="c1"># Default</span>

            <span class="c1"># Enable pitch if speed threshold reached</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">pitch_enabled</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch_enable_speed_m_s</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Time </span><span class="si">{</span><span class="n">time_elapsed</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s: Speed (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> m/s) reached threshold (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pitch_enable_speed_m_s</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> m/s). Pitch enabled.&quot;</span><span class="p">)</span>
                <span class="n">pitch_enabled</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">phase</span> <span class="o">=</span> <span class="s2">&quot;Climb&quot;</span>

            <span class="c1"># Determine target pitch based on phase</span>
            <span class="k">if</span> <span class="n">phase</span> <span class="o">==</span> <span class="s2">&quot;Takeoff Roll&quot;</span><span class="p">:</span>
                <span class="n">target_pitch</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># Keep pitch flat on ground</span>
            <span class="k">elif</span> <span class="n">phase</span> <span class="o">==</span> <span class="s2">&quot;Climb&quot;</span><span class="p">:</span>
                <span class="n">predicted_altitude_gain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_level_off_alt_gain</span><span class="p">()</span>
                <span class="n">trigger_altitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_altitude_m</span> <span class="o">-</span> <span class="n">predicted_altitude_gain</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">&gt;=</span> <span class="n">trigger_altitude</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Time </span><span class="si">{</span><span class="n">time_elapsed</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s: Alt (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alt</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">m) reached trigger (</span><span class="si">{</span><span class="n">trigger_altitude</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">m) for level off. Initiating Level Off.&quot;</span><span class="p">)</span>
                    <span class="n">phase</span> <span class="o">=</span> <span class="s2">&quot;Level Off&quot;</span>
                    <span class="n">level_off_initiated</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">target_pitch</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">target_pitch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_pitch</span> <span class="k">if</span> <span class="n">pitch_enabled</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Level Off</span>
                <span class="n">target_pitch</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">level_off_initiated</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">target_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span>

            <span class="c1"># Log current state</span>
            <span class="n">current_pitch_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="p">)</span>
            <span class="n">initial_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">current_pitch_rad</span><span class="p">)</span>
            <span class="n">initial_hs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">current_pitch_rad</span><span class="p">)</span>
            <span class="n">log_entry</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;plane_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">flight_id</span><span class="p">,</span>
                <span class="s2">&quot;time_s&quot;</span><span class="p">:</span> <span class="n">time_elapsed</span><span class="p">,</span>
                <span class="s2">&quot;speed_ms&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span>
                <span class="s2">&quot;alt_m&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span>
                <span class="s2">&quot;roll_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">,</span>
                <span class="s2">&quot;pitch_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span>
                <span class="s2">&quot;yaw_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaw</span><span class="p">,</span>
                <span class="s2">&quot;bearing_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span><span class="p">,</span>
                <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span>
                <span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="s2">&quot;Initial Climb&quot;</span><span class="p">,</span>
                <span class="s2">&quot;plane_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_type</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">log_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">log_entry</span><span class="p">)</span>

            <span class="c1"># Control adjustments for pitch and speed</span>
            <span class="n">pitch_error</span> <span class="o">=</span> <span class="n">target_pitch</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span>
            <span class="n">delta_pitch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">pitch_error</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span> <span class="o">*</span> <span class="n">dt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>
            <span class="n">next_pitch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">+</span> <span class="n">delta_pitch</span>
            <span class="n">next_pitch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">next_pitch</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">climb_pitch_target_deg</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">climb_pitch_target_deg</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">&lt;</span> <span class="n">target_speed</span><span class="p">:</span>
                <span class="n">delta_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vehicle_acceleration</span> <span class="o">*</span> <span class="n">dt</span>
                <span class="n">next_speed</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">+</span> <span class="n">delta_speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">0.05</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">/</span> <span class="n">target_speed</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.95</span><span class="p">),</span>
                    <span class="n">target_speed</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">next_speed</span> <span class="o">=</span> <span class="n">target_speed</span>

            <span class="c1"># Simulate physics for next step</span>
            <span class="n">next_pitch_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">next_pitch</span><span class="p">)</span>
            <span class="n">vertical_speed</span> <span class="o">=</span> <span class="n">next_speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">next_pitch_rad</span><span class="p">)</span>
            <span class="n">horizontal_speed</span> <span class="o">=</span> <span class="n">next_speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">next_pitch_rad</span><span class="p">)</span>

            <span class="c1"># Update altitude</span>
            <span class="n">delta_alt</span> <span class="o">=</span> <span class="n">vertical_speed</span> <span class="o">*</span> <span class="n">dt</span>
            <span class="n">next_alt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">+</span> <span class="n">delta_alt</span>
            <span class="k">if</span> <span class="n">phase</span> <span class="o">!=</span> <span class="s2">&quot;Takeoff Roll&quot;</span> <span class="ow">and</span> <span class="n">next_alt</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">next_alt</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Update coordinates with geopy if available, else fallback</span>
            <span class="n">distance_meters</span> <span class="o">=</span> <span class="n">horizontal_speed</span> <span class="o">*</span> <span class="n">dt</span>
            <span class="k">if</span> <span class="n">distance_meters</span> <span class="o">&gt;</span> <span class="mf">1e-3</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;Point&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;geodesic&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
                    <span class="n">start_point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">longitude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">destination</span> <span class="o">=</span> <span class="n">geodesic</span><span class="p">(</span><span class="n">meters</span><span class="o">=</span><span class="n">distance_meters</span><span class="p">)</span><span class="o">.</span><span class="n">destination</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="n">start_point</span><span class="p">,</span> <span class="n">bearing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing</span><span class="p">)</span>
                    <span class="n">next_coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">destination</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="n">destination</span><span class="o">.</span><span class="n">longitude</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lat1_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">lon1_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">bearing_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing</span><span class="p">)</span>
                    <span class="n">earth_radius_m</span> <span class="o">=</span> <span class="mi">6371000</span>  <span class="c1"># Earth radius approx</span>

                    <span class="n">ang_dist</span> <span class="o">=</span> <span class="n">distance_meters</span> <span class="o">/</span> <span class="n">earth_radius_m</span>

                    <span class="n">lat2_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">asin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat1_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ang_dist</span><span class="p">)</span> <span class="o">+</span>
                                         <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat1_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ang_dist</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">bearing_rad</span><span class="p">))</span>
                    <span class="n">lon2_rad</span> <span class="o">=</span> <span class="n">lon1_rad</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">bearing_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ang_dist</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat1_rad</span><span class="p">),</span>
                                                     <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ang_dist</span><span class="p">)</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat1_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat2_rad</span><span class="p">))</span>

                    <span class="n">next_coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">lat2_rad</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">lon2_rad</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">next_coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>

            <span class="c1"># Update state for next iteration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="n">next_speed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">next_pitch</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">=</span> <span class="n">next_alt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="n">next_coords</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">+=</span> <span class="n">next_speed</span>
            <span class="n">time_elapsed</span> <span class="o">+=</span> <span class="n">dt</span>

            <span class="c1"># Check for end of simulation</span>
            <span class="k">if</span> <span class="n">level_off_initiated</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">pitch_threshold</span><span class="p">:</span>
                <span class="n">alt_error</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_altitude_m</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Level Off Complete. Pitch (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">°) near zero at time </span><span class="si">{</span><span class="n">time_elapsed</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s. &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;Final Alt: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alt</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">m (Error: </span><span class="si">{</span><span class="n">alt_error</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">m) ---&quot;</span><span class="p">)</span>
                <span class="n">final_log_entry</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;plane_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">flight_id</span><span class="p">,</span>
                    <span class="s2">&quot;time_s&quot;</span><span class="p">:</span> <span class="n">time_elapsed</span><span class="p">,</span>
                    <span class="s2">&quot;speed_ms&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span>
                    <span class="s2">&quot;alt_m&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span>
                    <span class="s2">&quot;roll_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">,</span>
                    <span class="s2">&quot;pitch_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span>
                    <span class="s2">&quot;yaw_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaw</span><span class="p">,</span>
                    <span class="s2">&quot;bearing_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span><span class="p">,</span>
                    <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span>
                    <span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="s2">&quot;Initial Climb&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;plane_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_type</span>
                <span class="p">}</span>
                <span class="n">log_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_log_entry</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="c1"># Safety break for max simulation time</span>
            <span class="k">if</span> <span class="n">time_elapsed</span> <span class="o">&gt;</span> <span class="mi">72000</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Simulation exceeded maximum time limit (20hr).&quot;</span><span class="p">)</span>
                <span class="n">final_log_entry</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;plane_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">flight_id</span><span class="p">,</span>
                    <span class="s2">&quot;time_s&quot;</span><span class="p">:</span> <span class="n">time_elapsed</span><span class="p">,</span>
                    <span class="s2">&quot;speed_ms&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span>
                    <span class="s2">&quot;alt_m&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span>
                    <span class="s2">&quot;roll_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">,</span>
                    <span class="s2">&quot;pitch_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span>
                    <span class="s2">&quot;yaw_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaw</span><span class="p">,</span>
                    <span class="s2">&quot;bearing_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span><span class="p">,</span>
                    <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span>
                    <span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="s2">&quot;Initial Climb&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;plane_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_type</span>
                <span class="p">}</span>
                <span class="n">log_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_log_entry</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="n">trajectory_log_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">log_entries</span><span class="p">)</span>
        <span class="n">trajectory_log_df</span> <span class="o">=</span> <span class="n">trajectory_log_df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df_col_names</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">trajectory_log_df</span></div>


<div class="viewcode-block" id="plane_trajectory.perform_pitch_correction_to_level">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.perform_pitch_correction_to_level">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">perform_pitch_correction_to_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gradually adjusts the aircraft&#39;s pitch angle back to level (zero).</span>

<span class="sd">        This function simulates the pitch correction process where the pitch angle</span>
<span class="sd">        approaches zero at a controlled angular speed reduced by a factor of 10.</span>
<span class="sd">        During correction, the aircraft&#39;s position and altitude are updated accordingly.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            dt (float): Time step for each simulation iteration in seconds.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list of dict: Log entries recording the aircraft state at each time step,</span>
<span class="sd">            including position, pitch, altitude, and other relevant parameters.</span>

<span class="sd">        Explanation:</span>
<span class="sd">            - Pitch angle is decreased or increased stepwise towards zero.</span>
<span class="sd">            - Horizontal distance traveled is updated based on speed and pitch.</span>
<span class="sd">            - Geographic position is updated using geodesic destination calculation.</span>
<span class="sd">            - Altitude changes are calculated from vertical component of speed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pitch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span>
        <span class="n">pitch_angular_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span> <span class="o">/</span> <span class="mi">10</span>
        <span class="n">log_entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">distance_traveled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">pitch_delta</span> <span class="o">=</span> <span class="n">pitch_angular_speed</span> <span class="o">*</span> <span class="n">dt</span>

            <span class="k">if</span> <span class="n">pitch</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pitch</span> <span class="o">-=</span> <span class="n">pitch_delta</span>
                <span class="k">if</span> <span class="n">pitch</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">pitch</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">pitch</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pitch</span> <span class="o">+=</span> <span class="n">pitch_delta</span>
                <span class="k">if</span> <span class="n">pitch</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">pitch</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">horizontal_distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>
            <span class="n">distance_traveled</span> <span class="o">+=</span> <span class="n">horizontal_distance</span>

            <span class="n">destination</span> <span class="o">=</span> <span class="n">Geodistance</span><span class="p">(</span><span class="n">meters</span><span class="o">=</span><span class="n">horizontal_distance</span><span class="p">)</span><span class="o">.</span><span class="n">destination</span><span class="p">(</span>
                <span class="n">point</span><span class="o">=</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="n">bearing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="n">distance_traveled</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">pitch</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="n">destination</span><span class="o">.</span><span class="n">longitude</span>

            <span class="n">log_entries</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;plane_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">flight_id</span><span class="p">,</span>
                <span class="s2">&quot;time_s&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="s2">&quot;speed_ms&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span>
                <span class="s2">&quot;alt_m&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span>
                <span class="s2">&quot;roll_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">,</span>
                <span class="s2">&quot;pitch_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span>
                <span class="s2">&quot;yaw_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaw</span><span class="p">,</span>
                <span class="s2">&quot;bearing_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span><span class="p">,</span>
                <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span>
                <span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="s2">&quot;Pitch_to_Center&quot;</span><span class="p">,</span>
                <span class="s2">&quot;plane_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_type</span><span class="p">,</span>
            <span class="p">})</span>

            <span class="k">if</span> <span class="n">pitch</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="n">log_entries</span></div>


<div class="viewcode-block" id="plane_trajectory.estimate_altitude_change_for_pitch_correction">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.estimate_altitude_change_for_pitch_correction">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">estimate_altitude_change_for_pitch_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimates total altitude change expected while correcting pitch angle to zero.</span>

<span class="sd">        This method simulates the pitch angle reduction towards zero, calculating</span>
<span class="sd">        cumulative altitude gain or loss during the pitch correction maneuver.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            dt (float): Time step in seconds for the pitch correction simulation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Estimated net altitude change (meters) during pitch correction.</span>
<span class="sd">                   Positive values indicate altitude gain; negative values indicate loss.</span>

<span class="sd">        Explanation:</span>
<span class="sd">            - Simulates gradual pitch angle approach to zero at reduced angular speed.</span>
<span class="sd">            - Altitude changes are integrated from vertical speed component at each step.</span>
<span class="sd">            - Positive pitch reduces altitude gain; negative pitch reduces altitude.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pitch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span>
        <span class="n">pitch_angular_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span> <span class="o">/</span> <span class="mi">10</span>
        <span class="n">altitude_difference</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">pitch_delta</span> <span class="o">=</span> <span class="n">pitch_angular_speed</span> <span class="o">*</span> <span class="n">dt</span>

            <span class="k">if</span> <span class="n">pitch</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pitch</span> <span class="o">-=</span> <span class="n">pitch_delta</span>
                <span class="k">if</span> <span class="n">pitch</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">pitch</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">altitude_difference</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>

            <span class="k">if</span> <span class="n">pitch</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pitch</span> <span class="o">+=</span> <span class="n">pitch_delta</span>
                <span class="k">if</span> <span class="n">pitch</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">pitch</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">altitude_difference</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>

            <span class="k">if</span> <span class="n">pitch</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="n">altitude_difference</span></div>


<div class="viewcode-block" id="plane_trajectory.simulate_cruise_to_waypoint">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.simulate_cruise_to_waypoint">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">simulate_cruise_to_waypoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulates cruising flight to the current target waypoint with altitude adjustments.</span>

<span class="sd">        This function guides the aircraft towards the waypoint, controlling pitch to</span>
<span class="sd">        approach the target altitude smoothly, accelerating up to target speed, and</span>
<span class="sd">        adjusting position iteratively until close to the waypoint.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            dt (float): Time step in seconds for each simulation update.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A DataFrame logging the aircraft state at each step, including</span>
<span class="sd">            speed, altitude, pitch, roll, yaw, bearing, coordinates, distance traveled,</span>
<span class="sd">            and the current phase.</span>

<span class="sd">        Explanation:</span>
<span class="sd">            - Calculates bearing to waypoint and adjusts heading.</span>
<span class="sd">            - Determines target pitch based on altitude difference and distance.</span>
<span class="sd">            - Adjusts pitch up or down to reach target altitude smoothly.</span>
<span class="sd">            - Updates speed, position, altitude according to physics.</span>
<span class="sd">            - Uses geodesic calculations to update geographic coordinates.</span>
<span class="sd">            - Continues until aircraft is within half the target speed distance to waypoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_bearing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span><span class="p">][:</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">log_entries</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">prev_altitude</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">prev_delta_altitude</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">do_log</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">adapt_altitude_to_target</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Stage 1: adjust altitude to target</span>

        <span class="n">distance_to_waypoint</span> <span class="o">=</span> <span class="n">geodesic</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span><span class="p">][:</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">meters</span>
        <span class="n">altitude_diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">hypotenuse</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">altitude_diff</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">distance_to_waypoint</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">min_angle</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">distance_to_waypoint</span> <span class="o">/</span> <span class="n">hypotenuse</span><span class="p">)))</span>

        <span class="c1"># Determine target pitch based on min_angle and pitch limits</span>
        <span class="k">if</span> <span class="n">min_angle</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cruising_pitch_max</span> <span class="o">/</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">target_pitch</span> <span class="o">=</span> <span class="n">min_angle</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="k">elif</span> <span class="n">min_angle</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cruising_pitch_max</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">target_pitch</span> <span class="o">=</span> <span class="n">min_angle</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">min_angle</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cruising_pitch_max</span><span class="p">:</span>
            <span class="n">target_pitch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cruising_pitch_max</span>
        <span class="k">elif</span> <span class="n">min_angle</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_pitch</span><span class="p">:</span>
            <span class="n">target_pitch</span> <span class="o">=</span> <span class="n">min_angle</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">target_pitch</span> <span class="o">=</span> <span class="n">min_angle</span> <span class="o">+</span> <span class="mi">4</span>

        <span class="n">pitch_direction_up</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">new_bearing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_bearing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span><span class="p">][:</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">yaw_change</span> <span class="o">=</span> <span class="n">new_bearing</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">=</span> <span class="n">new_bearing</span>

            <span class="c1"># Accelerate towards target speed if needed</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span><span class="p">:</span>
                <span class="n">speed_increment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vehicle_acceleration</span> <span class="o">*</span> <span class="n">dt</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">+=</span> <span class="n">speed_increment</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span>

            <span class="k">if</span> <span class="n">adapt_altitude_to_target</span><span class="p">:</span>
                <span class="n">delta_altitude</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>

                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimate_altitude_change_for_pitch_correction</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">delta_altitude</span>
                        <span class="ow">or</span> <span class="p">(</span><span class="n">prev_delta_altitude</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">delta_altitude</span> <span class="o">&gt;</span> <span class="n">prev_delta_altitude</span><span class="p">)):</span>
                    <span class="n">log_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">perform_pitch_correction_to_level</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">))</span>
                    <span class="n">do_log</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">adapt_altitude_to_target</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pitch_delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">dt</span>
                    <span class="k">if</span> <span class="n">pitch_direction_up</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">+=</span> <span class="n">pitch_delta</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">&gt;</span> <span class="n">target_pitch</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">target_pitch</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">-=</span> <span class="n">pitch_delta</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">target_pitch</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="o">-</span><span class="n">target_pitch</span>
                    <span class="n">prev_delta_altitude</span> <span class="o">=</span> <span class="n">delta_altitude</span>

            <span class="k">if</span> <span class="n">do_log</span><span class="p">:</span>
                <span class="n">horizontal_distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">+=</span> <span class="n">horizontal_distance</span>
                <span class="n">destination</span> <span class="o">=</span> <span class="n">Geodistance</span><span class="p">(</span><span class="n">meters</span><span class="o">=</span><span class="n">horizontal_distance</span><span class="p">)</span><span class="o">.</span><span class="n">destination</span><span class="p">(</span>
                    <span class="n">point</span><span class="o">=</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="n">bearing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="n">destination</span><span class="o">.</span><span class="n">longitude</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">log_entries</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;plane_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">flight_id</span><span class="p">,</span>
                    <span class="s2">&quot;time_s&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                    <span class="s2">&quot;speed_ms&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span>
                    <span class="s2">&quot;alt_m&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span>
                    <span class="s2">&quot;roll_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">,</span>
                    <span class="s2">&quot;pitch_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span>
                    <span class="s2">&quot;yaw_deg&quot;</span><span class="p">:</span> <span class="n">yaw_change</span><span class="p">,</span>
                    <span class="s2">&quot;bearing_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span><span class="p">,</span>
                    <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span>
                    <span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Cruise to waypoint </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;plane_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_type</span><span class="p">,</span>
                <span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">do_log</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Break loop when close enough to waypoint (half target speed)</span>
            <span class="k">if</span> <span class="n">geodesic</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span><span class="p">][:</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">meters</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">trajectory_log_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">log_entries</span><span class="p">)</span>
        <span class="c1"># Ensure columns match df_col_names</span>
        <span class="n">trajectory_log_df</span> <span class="o">=</span> <span class="n">trajectory_log_df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df_col_names</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">trajectory_log_df</span></div>


<div class="viewcode-block" id="plane_trajectory.estimate_descent_distance">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.estimate_descent_distance">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">estimate_descent_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">target_angle</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span> <span class="n">descent_altitude_threshold_landing</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                                  <span class="n">pitch_angular_speed</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimates the horizontal distance required for the aircraft to safely descend</span>
<span class="sd">        from its current altitude to the landing threshold altitude, following a specified</span>
<span class="sd">        descent pitch angle and speed profile.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            dt (float): Simulation time step in seconds.</span>
<span class="sd">            target_angle (float): Desired descent pitch angle in degrees (negative for descent).</span>
<span class="sd">            descent_altitude_threshold_landing (float): Altitude threshold in meters</span>
<span class="sd">                at which landing procedures are initiated.</span>
<span class="sd">            pitch_angular_speed (float): Angular speed for pitch adjustment during descent.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Estimated horizontal distance in meters needed to complete the descent.</span>

<span class="sd">        Explanation:</span>
<span class="sd">            - Simulates descent trajectory by iteratively adjusting pitch angle toward target.</span>
<span class="sd">            - Models speed reduction when below landing altitude and near stall speeds.</span>
<span class="sd">            - Calculates geographic position updates via geodesic calculations.</span>
<span class="sd">            - Applies a simplified altitude loss acceleration factor for stall conditions.</span>
<span class="sd">            - Stops simulation when altitude reaches zero or below.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span>
        <span class="n">altitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt</span>
        <span class="n">distance_traveled</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">pitch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span>

        <span class="n">alt_loss_max_acceleration</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">target_angle</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">new_bearing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_bearing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span><span class="p">][:</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">yaw_change</span> <span class="o">=</span> <span class="n">new_bearing</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">=</span> <span class="n">new_bearing</span>

            <span class="k">if</span> <span class="n">altitude</span> <span class="o">&gt;</span> <span class="n">descent_altitude_threshold_landing</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pitch</span> <span class="o">&gt;</span> <span class="n">target_angle</span><span class="p">:</span>
                    <span class="n">pitch_delta</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span>
                    <span class="n">pitch</span> <span class="o">-=</span> <span class="n">pitch_delta</span>
                    <span class="n">pitch</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="n">target_angle</span><span class="p">)</span>

                <span class="n">horizontal_distance</span> <span class="o">=</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>
                <span class="n">distance_traveled</span> <span class="o">+=</span> <span class="n">horizontal_distance</span>
                <span class="n">destination</span> <span class="o">=</span> <span class="n">Geodistance</span><span class="p">(</span><span class="n">meters</span><span class="o">=</span><span class="n">horizontal_distance</span><span class="p">)</span><span class="o">.</span><span class="n">destination</span><span class="p">(</span>
                    <span class="n">point</span><span class="o">=</span><span class="n">Point</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="n">bearing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing</span>
                <span class="p">)</span>
                <span class="n">altitude</span> <span class="o">+=</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>
                <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="n">destination</span><span class="o">.</span><span class="n">longitude</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pitch</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">landing_pitch_target_deg</span> <span class="ow">and</span> <span class="n">speed</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">stall_speed_threshold_m_s</span><span class="p">:</span>
                    <span class="n">pitch_delta</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span> <span class="o">*</span> <span class="mf">0.10</span> <span class="o">*</span> <span class="n">pitch_angular_speed</span>
                    <span class="n">pitch</span> <span class="o">+=</span> <span class="n">pitch_delta</span>
                    <span class="n">pitch</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">landing_pitch_target_deg</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">pitch</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">speed</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stall_speed_threshold_m_s</span><span class="p">:</span>
                    <span class="n">pitch_delta</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span> <span class="o">*</span> <span class="mf">0.10</span> <span class="o">*</span> <span class="n">pitch_angular_speed</span>
                    <span class="n">pitch</span> <span class="o">+=</span> <span class="n">pitch_delta</span>
                    <span class="n">pitch</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">speed</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">landing_speed_m_s</span><span class="p">:</span>
                    <span class="n">deceleration</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vehicle_deceleration</span>
                    <span class="n">speed_reduction_factor</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
                        <span class="mf">0.1</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span>
                        <span class="mf">0.9</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span>
                        <span class="p">(</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">landing_speed_m_s</span><span class="p">)</span> <span class="o">-</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">landing_speed_m_s</span><span class="p">)</span>
                        <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">landing_speed_m_s</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">speed</span> <span class="o">-=</span> <span class="n">deceleration</span> <span class="o">*</span> <span class="n">speed_reduction_factor</span>
                    <span class="n">speed</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">landing_speed_m_s</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">speed</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">stall_speed_threshold_m_s</span><span class="p">:</span>
                    <span class="n">altitude</span> <span class="o">-=</span> <span class="n">alt_loss_max_acceleration</span> <span class="o">/</span> <span class="p">(</span><span class="n">speed</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">landing_speed_m_s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

                <span class="n">horizontal_distance</span> <span class="o">=</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>
                <span class="n">distance_traveled</span> <span class="o">+=</span> <span class="n">horizontal_distance</span>
                <span class="n">destination</span> <span class="o">=</span> <span class="n">Geodistance</span><span class="p">(</span><span class="n">meters</span><span class="o">=</span><span class="n">horizontal_distance</span><span class="p">)</span><span class="o">.</span><span class="n">destination</span><span class="p">(</span>
                    <span class="n">point</span><span class="o">=</span><span class="n">Point</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="n">bearing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing</span>
                <span class="p">)</span>
                <span class="n">altitude</span> <span class="o">+=</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>
                <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="n">destination</span><span class="o">.</span><span class="n">longitude</span>

                <span class="k">if</span> <span class="n">altitude</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">altitude</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">break</span>

        <span class="k">return</span> <span class="n">distance_traveled</span></div>


<div class="viewcode-block" id="plane_trajectory.perform_descent">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.perform_descent">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">perform_descent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">target_angle</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span> <span class="n">descent_altitude_threshold_landing</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">pitch_angular_speed</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulates the aircraft&#39;s descent phase towards the final waypoint, including</span>
<span class="sd">        pitch control, speed adjustments, altitude loss, and position updates.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            dt (float): Time step in seconds for each simulation iteration.</span>
<span class="sd">            target_angle (float): Target pitch angle for descent (negative value in degrees).</span>
<span class="sd">            descent_altitude_threshold_landing (float): Altitude threshold (meters) to</span>
<span class="sd">                modify descent behavior for landing.</span>
<span class="sd">            pitch_angular_speed (float): Angular speed for pitch control during descent.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Log of aircraft states throughout descent, including position,</span>
<span class="sd">            speed, pitch, altitude, and phase.</span>

<span class="sd">        Explanation:</span>
<span class="sd">            - Adjusts pitch angle gradually toward target descent angle.</span>
<span class="sd">            - Reduces speed progressively as the aircraft nears landing speed.</span>
<span class="sd">            - Models altitude loss due to stall when speed drops below stall threshold.</span>
<span class="sd">            - Updates geographic position using geodesic calculations.</span>
<span class="sd">            - Continues until altitude reaches zero, indicating landing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_bearing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">log_entries</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span>
        <span class="n">altitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt</span>
        <span class="n">distance_traveled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span>
        <span class="n">pitch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span>

        <span class="n">alt_loss_max_acceleration</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">target_angle</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">new_bearing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_bearing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span><span class="p">][:</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">yaw_change</span> <span class="o">=</span> <span class="n">new_bearing</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">=</span> <span class="n">new_bearing</span>

            <span class="k">if</span> <span class="n">altitude</span> <span class="o">&gt;</span> <span class="n">descent_altitude_threshold_landing</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pitch</span> <span class="o">&gt;</span> <span class="n">target_angle</span><span class="p">:</span>
                    <span class="n">pitch_delta</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span>
                    <span class="n">pitch</span> <span class="o">-=</span> <span class="n">pitch_delta</span>
                    <span class="n">pitch</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="n">target_angle</span><span class="p">)</span>

                <span class="n">horizontal_distance</span> <span class="o">=</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>
                <span class="n">distance_traveled</span> <span class="o">+=</span> <span class="n">horizontal_distance</span>
                <span class="n">destination</span> <span class="o">=</span> <span class="n">Geodistance</span><span class="p">(</span><span class="n">meters</span><span class="o">=</span><span class="n">horizontal_distance</span><span class="p">)</span><span class="o">.</span><span class="n">destination</span><span class="p">(</span>
                    <span class="n">point</span><span class="o">=</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="n">bearing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing</span>
                <span class="p">)</span>
                <span class="n">altitude</span> <span class="o">+=</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pitch</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">landing_pitch_target_deg</span> <span class="ow">and</span> <span class="n">speed</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">stall_speed_threshold_m_s</span><span class="p">:</span>
                    <span class="n">pitch_delta</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span> <span class="o">*</span> <span class="mf">0.10</span> <span class="o">*</span> <span class="n">pitch_angular_speed</span>
                    <span class="n">pitch</span> <span class="o">+=</span> <span class="n">pitch_delta</span>
                    <span class="n">pitch</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">landing_pitch_target_deg</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">pitch</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">speed</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stall_speed_threshold_m_s</span><span class="p">:</span>
                    <span class="n">pitch_delta</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span> <span class="o">*</span> <span class="mf">0.10</span> <span class="o">*</span> <span class="n">pitch_angular_speed</span>
                    <span class="n">pitch</span> <span class="o">+=</span> <span class="n">pitch_delta</span>
                    <span class="n">pitch</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">speed</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">landing_speed_m_s</span><span class="p">:</span>
                    <span class="n">deceleration</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vehicle_deceleration</span>
                    <span class="n">speed_reduction_factor</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
                        <span class="mf">0.1</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span>
                        <span class="mf">0.9</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span>
                        <span class="p">(</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">landing_speed_m_s</span><span class="p">)</span> <span class="o">-</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">landing_speed_m_s</span><span class="p">)</span>
                        <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">landing_speed_m_s</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">speed</span> <span class="o">-=</span> <span class="n">deceleration</span> <span class="o">*</span> <span class="n">speed_reduction_factor</span>
                    <span class="n">speed</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">landing_speed_m_s</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">speed</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">stall_speed_threshold_m_s</span><span class="p">:</span>
                    <span class="n">altitude</span> <span class="o">-=</span> <span class="n">alt_loss_max_acceleration</span> <span class="o">/</span> <span class="p">(</span><span class="n">speed</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">landing_speed_m_s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

                <span class="n">horizontal_distance</span> <span class="o">=</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>
                <span class="n">distance_traveled</span> <span class="o">+=</span> <span class="n">horizontal_distance</span>
                <span class="n">destination</span> <span class="o">=</span> <span class="n">Geodistance</span><span class="p">(</span><span class="n">meters</span><span class="o">=</span><span class="n">horizontal_distance</span><span class="p">)</span><span class="o">.</span><span class="n">destination</span><span class="p">(</span>
                    <span class="n">point</span><span class="o">=</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="n">bearing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing</span>
                <span class="p">)</span>
                <span class="n">altitude</span> <span class="o">+=</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>

                <span class="k">if</span> <span class="n">altitude</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">altitude</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Update state variables</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="n">speed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="n">distance_traveled</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">=</span> <span class="n">altitude</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">pitch</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="n">destination</span><span class="o">.</span><span class="n">longitude</span>

            <span class="n">log_entries</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;plane_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">flight_id</span><span class="p">,</span>
                <span class="s2">&quot;time_s&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="s2">&quot;speed_ms&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span>
                <span class="s2">&quot;alt_m&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span>
                <span class="s2">&quot;roll_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">,</span>
                <span class="s2">&quot;pitch_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span>
                <span class="s2">&quot;yaw_deg&quot;</span><span class="p">:</span> <span class="n">yaw_change</span><span class="p">,</span>
                <span class="s2">&quot;bearing_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span><span class="p">,</span>
                <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span>
                <span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Descending to the final waypoint </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;plane_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_type</span><span class="p">,</span>
            <span class="p">})</span>

            <span class="k">if</span> <span class="n">altitude</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">trajectory_log_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">log_entries</span><span class="p">)</span>
        <span class="c1"># Ensure exact columns using reindex before returning</span>
        <span class="n">trajectory_log_df</span> <span class="o">=</span> <span class="n">trajectory_log_df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df_col_names</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">trajectory_log_df</span></div>


<div class="viewcode-block" id="plane_trajectory.cruise_to_destination">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.cruise_to_destination">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cruise_to_destination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Controls the aircraft cruise phase toward the final destination waypoint,</span>
<span class="sd">        calculating when to initiate descent based on estimated required descent distance.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            dt (float): Simulation time step in seconds.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Complete flight log from cruise to final descent, combining</span>
<span class="sd">            cruise and descent logs, including positions, speeds, altitudes, and phases.</span>

<span class="sd">        Explanation:</span>
<span class="sd">            - Calculates the distance required to descend safely using estimate_descent_distance().</span>
<span class="sd">            - Adjusts descent parameters if needed to ensure landing within waypoint.</span>
<span class="sd">            - Simulates cruise flight until aircraft is within descent initiation distance.</span>
<span class="sd">            - Then calls perform_descent() to complete the approach and landing.</span>
<span class="sd">            - Logs all states continuously and concatenates cruise and descent data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_bearing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">log_entries</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">dist_needed_for_landing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_descent_distance</span><span class="p">(</span>
            <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
            <span class="n">target_angle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">descent_pitch_target_deg</span><span class="p">,</span>
            <span class="n">descent_alt_treshold_landing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">descent_altitude_threshold_landing_m</span><span class="p">,</span>
            <span class="n">pitch_angular_speed</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">distance_to_final_waypoint</span> <span class="o">=</span> <span class="n">geodesic</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">meters</span>
        <span class="n">initial_descent_pitch_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">descent_pitch_target_deg</span>
        <span class="n">pitch_angular_speed</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">dist_needed_for_landing</span> <span class="o">&gt;</span> <span class="n">distance_to_final_waypoint</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Landing setup with current plane simulation parameters not possible, attempting more aggressive parameters to land at last waypoint&quot;</span><span class="p">)</span>

        <span class="c1"># Adjust descent parameters if distance needed to land is too large</span>
        <span class="k">while</span> <span class="n">dist_needed_for_landing</span> <span class="o">&gt;</span> <span class="n">distance_to_final_waypoint</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span><span class="p">:</span>
                <span class="n">speed_increment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vehicle_acceleration</span> <span class="o">*</span> <span class="n">dt</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">+=</span> <span class="n">speed_increment</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">descent_pitch_target_deg</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">descent_altitude_threshold_landing_m</span> <span class="o">+=</span> <span class="mi">100</span>
            <span class="n">pitch_angular_speed</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">initial_descent_pitch_target</span><span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">descent_pitch_target_deg</span><span class="p">)</span>
            <span class="n">dist_needed_for_landing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_descent_distance</span><span class="p">(</span>
                <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
                <span class="n">target_angle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">descent_pitch_target_deg</span><span class="p">,</span>
                <span class="n">descent_alt_treshold_landing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">descent_altitude_threshold_landing_m</span><span class="p">,</span>
                <span class="n">pitch_angular_speed</span><span class="o">=</span><span class="n">pitch_angular_speed</span>
            <span class="p">)</span>

        <span class="c1"># Cruise until within descent distance, then perform descent</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">current_distance_to_waypoint</span> <span class="o">=</span> <span class="n">geodesic</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">meters</span>
            <span class="k">if</span> <span class="n">current_distance_to_waypoint</span> <span class="o">&gt;</span> <span class="n">dist_needed_for_landing</span><span class="p">:</span>
                <span class="n">new_bearing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_bearing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span><span class="p">][:</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">yaw_change</span> <span class="o">=</span> <span class="n">new_bearing</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">=</span> <span class="n">new_bearing</span>

                <span class="n">horizontal_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">+=</span> <span class="n">horizontal_speed</span> <span class="o">*</span> <span class="n">dt</span>
                <span class="n">destination</span> <span class="o">=</span> <span class="n">Geodistance</span><span class="p">(</span><span class="n">meters</span><span class="o">=</span><span class="n">horizontal_speed</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span><span class="o">.</span><span class="n">destination</span><span class="p">(</span>
                    <span class="n">point</span><span class="o">=</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="n">bearing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="n">destination</span><span class="o">.</span><span class="n">longitude</span>

                <span class="n">log_entries</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;plane_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">flight_id</span><span class="p">,</span>
                    <span class="s2">&quot;time_s&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                    <span class="s2">&quot;speed_ms&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span>
                    <span class="s2">&quot;alt_m&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span>
                    <span class="s2">&quot;roll_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">,</span>
                    <span class="s2">&quot;pitch_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span>
                    <span class="s2">&quot;yaw_deg&quot;</span><span class="p">:</span> <span class="n">yaw_change</span><span class="p">,</span>
                    <span class="s2">&quot;bearing_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span><span class="p">,</span>
                    <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span>
                    <span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Cruise to last waypoint (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;plane_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_type</span><span class="p">,</span>
                <span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">descent_log_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">perform_descent</span><span class="p">(</span>
                    <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
                    <span class="n">target_angle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">descent_pitch_target_deg</span><span class="p">,</span>
                    <span class="n">descent_alt_treshold_landing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">descent_altitude_threshold_landing_m</span><span class="p">,</span>
                    <span class="n">pitch_angular_speed</span><span class="o">=</span><span class="n">pitch_angular_speed</span>
                <span class="p">)</span>
                <span class="k">break</span>

        <span class="n">trajectory_log_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">log_entries</span><span class="p">)</span>
        <span class="c1"># Ensure exact columns using reindex before returning</span>
        <span class="n">trajectory_log_df</span> <span class="o">=</span> <span class="n">trajectory_log_df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df_col_names</span><span class="p">)</span>
        <span class="n">trajectory_log_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">trajectory_log_df</span><span class="p">,</span> <span class="n">descent_log_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">trajectory_log_df</span></div>


<div class="viewcode-block" id="plane_trajectory.calculate_turn_direction_and_angle">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.calculate_turn_direction_and_angle">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_turn_direction_and_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_bearing</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determines the optimal turn direction (left or right) and the minimal angular</span>
<span class="sd">        difference needed to reach the target bearing from the current bearing.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            target_bearing (float): Target heading bearing in degrees (0-360).</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple(bool, float):</span>
<span class="sd">                - bool: True if the aircraft should turn right; False if left.</span>
<span class="sd">                - float: Angle in degrees representing the smallest rotation needed.</span>

<span class="sd">        Explanation:</span>
<span class="sd">            - Uses modular arithmetic on bearings (0-360 degrees).</span>
<span class="sd">            - Chooses turn direction to minimize angular travel.</span>
<span class="sd">            - Accounts for wrap-around at 0/360 degrees.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bearing_difference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">-</span> <span class="n">target_bearing</span>
        <span class="n">abs_difference</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">bearing_difference</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">abs_difference</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">:</span>
            <span class="n">turn_right</span> <span class="o">=</span> <span class="n">bearing_difference</span> <span class="o">&lt;</span> <span class="mi">0</span>
            <span class="n">rotation_angle</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">target_bearing</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bearing_difference</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">turn_right</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">rotation_angle</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">-</span> <span class="mi">360</span> <span class="o">-</span> <span class="n">target_bearing</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">turn_right</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">rotation_angle</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">+</span> <span class="mi">360</span> <span class="o">-</span> <span class="n">target_bearing</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">turn_right</span><span class="p">,</span> <span class="n">rotation_angle</span></div>


<div class="viewcode-block" id="plane_trajectory.haversine_distance">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.haversine_distance">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">haversine_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">lat2</span><span class="p">,</span> <span class="n">lon2</span><span class="p">):</span>
        <span class="n">R</span> <span class="o">=</span> <span class="mi">6371000</span>  <span class="c1"># Earth radius in meters</span>
        <span class="n">phi1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span>
        <span class="n">phi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span>
        <span class="n">dphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat2</span> <span class="o">-</span> <span class="n">lat1</span><span class="p">)</span>
        <span class="n">dlambda</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lon2</span> <span class="o">-</span> <span class="n">lon1</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dphi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dlambda</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">R</span> <span class="o">*</span> <span class="n">c</span></div>


<div class="viewcode-block" id="plane_trajectory.estimate_roll_pitch_correction_rotation">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.estimate_roll_pitch_correction_rotation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">estimate_roll_pitch_correction_rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">current_roll</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimates the total angular rotation in degrees the aircraft will undergo while</span>
<span class="sd">        correcting its roll angle back to zero by simulating incremental roll adjustments.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            dt (float): Time step in seconds.</span>
<span class="sd">            current_roll (float or None): Optional starting roll angle in degrees;</span>
<span class="sd">                if None, uses the aircraft&#39;s current roll attribute.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Absolute total rotation in degrees accumulated during roll correction.</span>

<span class="sd">        Explanation:</span>
<span class="sd">            - Simulates roll angle decay towards zero at a constant angular speed.</span>
<span class="sd">            - Calculates cumulative rotation induced by pitch angular speed and roll.</span>
<span class="sd">            - Rotation is calculated as the integral of angular increments per dt.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">total_rotation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">roll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span> <span class="k">if</span> <span class="n">current_roll</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">current_roll</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">roll_change</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll_angular_speed</span> <span class="o">*</span> <span class="n">dt</span>
            <span class="k">if</span> <span class="n">roll</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">roll</span> <span class="o">-=</span> <span class="n">roll_change</span>
                <span class="k">if</span> <span class="n">roll</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">roll</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">roll</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">roll</span> <span class="o">+=</span> <span class="n">roll_change</span>
                <span class="k">if</span> <span class="n">roll</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">roll</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">incremental_rotation</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">roll</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_roll</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">roll</span><span class="p">))</span>
            <span class="n">total_rotation</span> <span class="o">+=</span> <span class="n">incremental_rotation</span>

            <span class="k">if</span> <span class="n">roll</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">total_rotation</span><span class="p">)</span></div>


<div class="viewcode-block" id="plane_trajectory.perform_roll_pitch_correction">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.perform_roll_pitch_correction">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">perform_roll_pitch_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs roll and pitch correction to stabilize the aircraft&#39;s orientation by</span>
<span class="sd">        gradually reducing the roll angle to zero, updating pitch accordingly, and</span>
<span class="sd">        adjusting the aircraft&#39;s bearing, altitude, and position during the maneuver.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            dt (float): Time step in seconds for each simulation iteration.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list of dict: A list of log entries capturing the aircraft&#39;s state at each</span>
<span class="sd">            timestep during the correction process, including position, attitude, speed,</span>
<span class="sd">            and phase information.</span>

<span class="sd">        Explanation:</span>
<span class="sd">            - Roll is incrementally adjusted towards zero at a fixed angular speed.</span>
<span class="sd">            - Pitch is computed based on the roll angle and pitch angular speed.</span>
<span class="sd">            - Bearing is updated considering the roll-induced angular changes.</span>
<span class="sd">            - Altitude changes are limited to avoid unrealistic jumps.</span>
<span class="sd">            - Geographic position is updated using geodesic calculations.</span>
<span class="sd">            - The process repeats until roll angle reaches zero, indicating level flight.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">earth_gravity</span> <span class="o">=</span> <span class="mf">9.807</span>  <span class="c1"># Not currently used but could be useful for future physics</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Gradually reduce roll angle toward zero</span>
            <span class="n">roll_change</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll_angular_speed</span> <span class="o">*</span> <span class="n">dt</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">roll</span> <span class="o">-=</span> <span class="n">roll_change</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">roll</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">roll</span> <span class="o">+=</span> <span class="n">roll_change</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">roll</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Update bearing based on roll and pitch angular speeds</span>
            <span class="n">bearing_increment</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_roll</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
                <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">+=</span> <span class="n">bearing_increment</span>

            <span class="c1"># Calculate pitch from roll</span>
            <span class="n">pitch</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_roll</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">pitch</span>

            <span class="c1"># Update altitude with a cap to limit unrealistic changes</span>
            <span class="n">altitude_increment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">+=</span> <span class="nb">min</span><span class="p">(</span><span class="n">altitude_increment</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>

            <span class="c1"># Update distance traveled along horizontal component</span>
            <span class="n">horizontal_distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">+=</span> <span class="n">horizontal_distance</span>

            <span class="c1"># Calculate new geographic coordinates based on movement and bearing</span>
            <span class="n">destination</span> <span class="o">=</span> <span class="n">Geodistance</span><span class="p">(</span><span class="n">meters</span><span class="o">=</span><span class="n">horizontal_distance</span><span class="p">)</span><span class="o">.</span><span class="n">destination</span><span class="p">(</span>
                <span class="n">point</span><span class="o">=</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="n">bearing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="n">destination</span><span class="o">.</span><span class="n">longitude</span>

            <span class="c1"># Log current state</span>
            <span class="n">log_entries</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;plane_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">flight_id</span><span class="p">,</span>
                <span class="s2">&quot;time_s&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="s2">&quot;speed_ms&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span>
                <span class="s2">&quot;alt_m&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span>
                <span class="s2">&quot;roll_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">,</span>
                <span class="s2">&quot;pitch_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span>
                <span class="s2">&quot;yaw_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaw</span><span class="p">,</span>
                <span class="s2">&quot;bearing_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span><span class="p">,</span>
                <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span>
                <span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;perform Roll-Pitch correction </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;plane_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_type</span><span class="p">,</span>
            <span class="p">})</span>

            <span class="c1"># Stop when roll is fully corrected (zero)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="n">log_entries</span></div>


<div class="viewcode-block" id="plane_trajectory.perform_turn_to_next_waypoint">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.perform_turn_to_next_waypoint">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">perform_turn_to_next_waypoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the aircraft&#39;s turn maneuver towards the next waypoint by calculating</span>
<span class="sd">        turn direction, controlling roll angle, adjusting speed for sharper turns, and</span>
<span class="sd">        updating position and orientation over time.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            dt (float): Time step in seconds for each iteration of the turn simulation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A DataFrame log of the aircraft&#39;s state at each timestep during</span>
<span class="sd">            the turn, including position, attitude, speed, and phase details.</span>

<span class="sd">        Explanation:</span>
<span class="sd">            - Determines shortest turn direction and rotation angle to target bearing.</span>
<span class="sd">            - Modulates speed lower when sharper turns are needed.</span>
<span class="sd">            - Adjusts roll angle progressively up to maximum limits based on turn direction.</span>
<span class="sd">            - Updates bearing and pitch angles accordingly.</span>
<span class="sd">            - Moves aircraft position along updated bearing and speed.</span>
<span class="sd">            - Continues until turn angle is less than roll-pitch correction threshold.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">total_rotation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">log_entries</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">target_bearing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_bearing</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span><span class="p">])</span>
        <span class="n">turn_right</span><span class="p">,</span> <span class="n">rotation_needed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_turn_direction_and_angle</span><span class="p">(</span><span class="n">target_bearing</span><span class="p">)</span>
        <span class="n">speed_ratio</span> <span class="o">=</span> <span class="n">rotation_needed</span> <span class="o">/</span> <span class="mi">180</span>
        <span class="n">target_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_speed_ratio_while_turning</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">speed_ratio</span><span class="p">)))</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">target_bearing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_bearing</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span><span class="p">])</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">rotation_needed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_turn_direction_and_angle</span><span class="p">(</span><span class="n">target_bearing</span><span class="p">)</span>

            <span class="c1"># Reduce speed for sharper turns if needed</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">&gt;</span> <span class="n">target_speed</span><span class="p">:</span>
                <span class="n">speed_decrement</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vehicle_deceleration</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">-=</span> <span class="n">speed_decrement</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">&lt;</span> <span class="n">target_speed</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="n">target_speed</span>

            <span class="c1"># Check if rotation required is less than estimated correction rotation</span>
            <span class="k">if</span> <span class="n">rotation_needed</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_roll_pitch_correction_rotation</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">):</span>
                <span class="n">log_entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">perform_roll_pitch_correction</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">))</span>
                <span class="k">break</span>

            <span class="c1"># Adjust roll angle based on turn direction</span>
            <span class="n">roll_delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll_angular_speed</span> <span class="o">*</span> <span class="n">dt</span>
            <span class="k">if</span> <span class="n">turn_right</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">roll</span> <span class="o">+=</span> <span class="n">roll_delta</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_roll</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">roll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_roll</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">roll</span> <span class="o">-=</span> <span class="n">roll_delta</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span> <span class="o">&lt;</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">max_roll</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">roll</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">max_roll</span>

            <span class="c1"># Calculate incremental rotation based on roll and pitch angular speeds</span>
            <span class="n">incremental_rotation</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_roll</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
                <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">))</span>
            <span class="n">total_rotation</span> <span class="o">+=</span> <span class="n">incremental_rotation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">+=</span> <span class="n">incremental_rotation</span>

            <span class="c1"># Keep bearing within [0, 360]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">&gt;</span> <span class="mi">360</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">-=</span> <span class="mi">360</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span> <span class="o">+=</span> <span class="mi">360</span>

            <span class="c1"># Calculate pitch based on roll</span>
            <span class="n">pitch</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_roll</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">pitch</span>

            <span class="c1"># Update altitude (capped) and distance traveled</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">+=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># TODO: refine altitude calculation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>

            <span class="c1"># Calculate new position based on distance and bearing</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>
            <span class="n">destination</span> <span class="o">=</span> <span class="n">Geodistance</span><span class="p">(</span><span class="n">meters</span><span class="o">=</span><span class="n">displacement</span><span class="p">)</span><span class="o">.</span><span class="n">destination</span><span class="p">(</span>
                <span class="n">point</span><span class="o">=</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="n">bearing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bearing</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="n">destination</span><span class="o">.</span><span class="n">longitude</span>

            <span class="c1"># Log current state</span>
            <span class="n">log_entries</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;plane_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">flight_id</span><span class="p">,</span>
                <span class="s2">&quot;time_s&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="s2">&quot;speed_ms&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span>
                <span class="s2">&quot;alt_m&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span>
                <span class="s2">&quot;roll_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">,</span>
                <span class="s2">&quot;pitch_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span>
                <span class="s2">&quot;yaw_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaw</span><span class="p">,</span>
                <span class="s2">&quot;bearing_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span><span class="p">,</span>
                <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span>
                <span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Turn to waypoint </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;plane_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_type</span><span class="p">,</span>
            <span class="p">})</span>

        <span class="n">trajectory_log</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">log_entries</span><span class="p">)</span>
        <span class="c1"># Ensure columns order matches df_col_names</span>
        <span class="n">trajectory_log</span> <span class="o">=</span> <span class="n">trajectory_log</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df_col_names</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">trajectory_log</span></div>


<div class="viewcode-block" id="plane_trajectory.get_min_waypoints_distance">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.get_min_waypoints_distance">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_min_waypoints_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the aircraft&#39;s turn maneuver towards the next waypoint,</span>
<span class="sd">        controlling roll angle, adjusting speed for sharper turns, and</span>
<span class="sd">        updating position and orientation over time. then compute the min distance needed between waypoints.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            dt (float): Time step in seconds for each iteration of the turn simulation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A DataFrame log of the aircraft&#39;s state at each timestep during</span>
<span class="sd">            the turn, including position, attitude, speed, and phase details.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">local_calculate_turn_direction_and_angle</span><span class="p">(</span><span class="n">bearing</span><span class="p">,</span> <span class="n">target_bearing</span><span class="p">):</span>
            <span class="n">bearing_difference</span> <span class="o">=</span> <span class="n">bearing</span> <span class="o">-</span> <span class="n">target_bearing</span>
            <span class="n">abs_difference</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">bearing_difference</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">abs_difference</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">:</span>
                <span class="n">turn_right</span> <span class="o">=</span> <span class="n">bearing_difference</span> <span class="o">&lt;</span> <span class="mi">0</span>
                <span class="n">rotation_angle</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">target_bearing</span> <span class="o">-</span> <span class="n">bearing</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bearing_difference</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">turn_right</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">rotation_angle</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">bearing</span> <span class="o">-</span> <span class="mi">360</span> <span class="o">-</span> <span class="n">target_bearing</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">turn_right</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">rotation_angle</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">bearing</span> <span class="o">+</span> <span class="mi">360</span> <span class="o">-</span> <span class="n">target_bearing</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">turn_right</span><span class="p">,</span> <span class="n">rotation_angle</span>

        <span class="n">total_rotation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">log_entries</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span>
        <span class="n">bearing</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">yaw</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">roll</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">pitch</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">alt</span> <span class="o">=</span> <span class="mi">10000</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># mutable copy</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">rotation_needed</span> <span class="o">=</span> <span class="mi">180</span>
        <span class="n">turn_right</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">speed_ratio</span> <span class="o">=</span> <span class="n">rotation_needed</span> <span class="o">/</span> <span class="mi">180</span>
        <span class="n">target_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_speed_ratio_while_turning</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">speed_ratio</span><span class="p">)))</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">target_bearing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_bearing</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">coords</span><span class="p">),</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">])</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">rotation_needed</span> <span class="o">=</span> <span class="n">local_calculate_turn_direction_and_angle</span><span class="p">(</span><span class="n">bearing</span><span class="p">,</span> <span class="n">target_bearing</span><span class="p">)</span>
            <span class="c1"># Reduce speed for sharper turns if needed</span>
            <span class="k">if</span> <span class="n">speed</span> <span class="o">&gt;</span> <span class="n">target_speed</span><span class="p">:</span>
                <span class="n">speed_decrement</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vehicle_deceleration</span>
                <span class="n">speed</span> <span class="o">-=</span> <span class="n">speed_decrement</span>
                <span class="k">if</span> <span class="n">speed</span> <span class="o">&lt;</span> <span class="n">target_speed</span><span class="p">:</span>
                    <span class="n">speed</span> <span class="o">=</span> <span class="n">target_speed</span>

            <span class="c1"># Check if rotation required is less than estimated correction rotation</span>
            <span class="k">if</span> <span class="n">rotation_needed</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_roll_pitch_correction_rotation</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">current_roll</span><span class="o">=</span><span class="n">roll</span><span class="p">):</span>
                <span class="c1"># log_entries.extend(self.perform_roll_pitch_correction(dt=dt))</span>
                <span class="k">break</span>

            <span class="c1"># Adjust roll angle based on turn direction</span>
            <span class="n">roll_delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll_angular_speed</span> <span class="o">*</span> <span class="n">dt</span>
            <span class="k">if</span> <span class="n">turn_right</span><span class="p">:</span>
                <span class="n">roll</span> <span class="o">+=</span> <span class="n">roll_delta</span>
                <span class="k">if</span> <span class="n">roll</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_roll</span><span class="p">:</span>
                    <span class="n">roll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_roll</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">roll</span> <span class="o">-=</span> <span class="n">roll_delta</span>
                <span class="k">if</span> <span class="n">roll</span> <span class="o">&lt;</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">max_roll</span><span class="p">:</span>
                    <span class="n">roll</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">max_roll</span>

            <span class="c1"># Calculate incremental rotation based on roll</span>
            <span class="n">incremental_rotation</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">roll</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_roll</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">roll</span><span class="p">))</span>
            <span class="n">total_rotation</span> <span class="o">+=</span> <span class="n">incremental_rotation</span>
            <span class="n">bearing</span> <span class="o">+=</span> <span class="n">incremental_rotation</span>

            <span class="c1"># Keep bearing within [0, 360]</span>
            <span class="k">if</span> <span class="n">bearing</span> <span class="o">&gt;</span> <span class="mi">360</span><span class="p">:</span>
                <span class="n">bearing</span> <span class="o">-=</span> <span class="mi">360</span>
            <span class="k">if</span> <span class="n">bearing</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">bearing</span> <span class="o">+=</span> <span class="mi">360</span>

            <span class="c1"># Calculate pitch based on roll</span>
            <span class="n">pitch</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pitch_angular_speed</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">roll</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_roll</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">roll</span><span class="p">))</span>

            <span class="c1"># Update altitude and distance</span>
            <span class="n">alt</span> <span class="o">+=</span> <span class="nb">min</span><span class="p">(</span><span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">distance</span> <span class="o">+=</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>

            <span class="c1"># Calculate new position</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>
            <span class="n">destination</span> <span class="o">=</span> <span class="n">Geodistance</span><span class="p">(</span><span class="n">meters</span><span class="o">=</span><span class="n">displacement</span><span class="p">)</span><span class="o">.</span><span class="n">destination</span><span class="p">(</span>
                <span class="n">point</span><span class="o">=</span><span class="n">Point</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="n">bearing</span><span class="o">=</span><span class="n">bearing</span>
            <span class="p">)</span>
            <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="n">destination</span><span class="o">.</span><span class="n">longitude</span>
            <span class="n">time</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Log current state</span>
            <span class="n">log_entries</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;plane_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">flight_id</span><span class="p">,</span>
                <span class="s2">&quot;time_s&quot;</span><span class="p">:</span> <span class="n">time</span><span class="p">,</span>
                <span class="s2">&quot;speed_ms&quot;</span><span class="p">:</span> <span class="n">speed</span><span class="p">,</span>
                <span class="s2">&quot;alt_m&quot;</span><span class="p">:</span> <span class="n">alt</span><span class="p">,</span>
                <span class="s2">&quot;roll_deg&quot;</span><span class="p">:</span> <span class="n">roll</span><span class="p">,</span>
                <span class="s2">&quot;pitch_deg&quot;</span><span class="p">:</span> <span class="n">pitch</span><span class="p">,</span>
                <span class="s2">&quot;yaw_deg&quot;</span><span class="p">:</span> <span class="n">yaw</span><span class="p">,</span>
                <span class="s2">&quot;bearing_deg&quot;</span><span class="p">:</span> <span class="n">bearing</span><span class="p">,</span>
                <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span>
                <span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Turn to waypoint </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;plane_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_type</span><span class="p">,</span>
            <span class="p">})</span>

        <span class="n">trajectory_log</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">log_entries</span><span class="p">)</span>
        <span class="n">trajectory_log</span> <span class="o">=</span> <span class="n">trajectory_log</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df_col_names</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">haversine_distance</span><span class="p">(</span><span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">lat2</span><span class="p">,</span> <span class="n">lon2</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Compute the Haversine distance between two points in decimal degrees.</span>
<span class="sd">            Returns distance in meters.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">R</span> <span class="o">=</span> <span class="mi">6371000</span>  <span class="c1"># Earth radius in meters</span>

            <span class="n">phi1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span>
            <span class="n">phi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span>
            <span class="n">dphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat2</span> <span class="o">-</span> <span class="n">lat1</span><span class="p">)</span>
            <span class="n">dlambda</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lon2</span> <span class="o">-</span> <span class="n">lon1</span><span class="p">)</span>

            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dphi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dlambda</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">R</span> <span class="o">*</span> <span class="n">c</span>

        <span class="n">trajectory_log</span><span class="p">[</span><span class="s2">&quot;distance_from_origin_m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">haversine_distance</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">trajectory_log</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">trajectory_log</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">trajectory_log</span><span class="p">[</span><span class="s2">&quot;distance_from_origin_m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span></div>


<div class="viewcode-block" id="plane_trajectory.plot">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.plot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates 2D plots of altitude, speed, and pitch angle over time during a flight</span>
<span class="sd">        phase using Plotly, displaying key flight parameters to visualize performance.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            df (pd.DataFrame): DataFrame containing logged flight data with columns:</span>
<span class="sd">                - &#39;time_s&#39;: time in seconds</span>
<span class="sd">                - &#39;alt_m&#39;: altitude in meters</span>
<span class="sd">                - &#39;speed_ms&#39;: speed in meters/second</span>
<span class="sd">                - &#39;pitch_deg&#39;: pitch angle in degrees</span>
<span class="sd">                - plus other columns for context (not all plotted)</span>

<span class="sd">        Returns:</span>
<span class="sd">            None: Displays interactive plots in the output environment.</span>

<span class="sd">        Explanation:</span>
<span class="sd">            - Altitude vs Time plot shows altitude changes during the flight phase.</span>
<span class="sd">            - Speed vs Time plot includes a horizontal line indicating target speed.</span>
<span class="sd">            - Pitch vs Time plot includes a horizontal line indicating max pitch limit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Final State after Climb:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Trajectory Log Head:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Trajectory Log Tail:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">())</span>

        <span class="c1"># Plot the altitude</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Plotting Altitude vs Time...&quot;</span><span class="p">)</span>
        <span class="n">fig_alt</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;time_s&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;alt_m&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Altitude during Climb Phase&#39;</span><span class="p">)</span>
        <span class="n">fig_alt</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;Time (seconds)&quot;</span><span class="p">,</span> <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Altitude (meters)&quot;</span><span class="p">)</span>
        <span class="n">fig_alt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Optional: Plot speed</span>
        <span class="n">fig_spd</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;time_s&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;speed_ms&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Speed during Climb Phase&#39;</span><span class="p">)</span>
        <span class="n">fig_spd</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;Time (seconds)&quot;</span><span class="p">,</span> <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Speed (m/s)&quot;</span><span class="p">)</span>
        <span class="c1"># Add target speed line</span>
        <span class="n">fig_spd</span><span class="o">.</span><span class="n">add_hline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_speed_m_s</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s2">&quot;dot&quot;</span><span class="p">,</span> <span class="n">annotation_text</span><span class="o">=</span><span class="s2">&quot;Target Speed&quot;</span><span class="p">,</span>
                          <span class="n">annotation_position</span><span class="o">=</span><span class="s2">&quot;bottom right&quot;</span><span class="p">)</span>
        <span class="n">fig_spd</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Optional: Plot Pitch</span>
        <span class="n">fig_pitch</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;time_s&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;pitch_deg&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Pitch Angle during Climb Phase&#39;</span><span class="p">)</span>
        <span class="n">fig_pitch</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;Time (seconds)&quot;</span><span class="p">,</span> <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Pitch (degrees)&quot;</span><span class="p">)</span>
        <span class="n">fig_pitch</span><span class="o">.</span><span class="n">add_hline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_pitch</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s2">&quot;dot&quot;</span><span class="p">,</span> <span class="n">annotation_text</span><span class="o">=</span><span class="s2">&quot;Max Pitch&quot;</span><span class="p">,</span>
                            <span class="n">annotation_position</span><span class="o">=</span><span class="s2">&quot;bottom right&quot;</span><span class="p">)</span>
        <span class="n">fig_pitch</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="plane_trajectory.plot_3d_flight_path">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.plot_3d_flight_path">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_3d_flight_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Visualizes the 3D flight path of the aircraft using Plotly, plotting latitude,</span>
<span class="sd">        longitude, and altitude with markers colored by altitude and hover information.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            df (pd.DataFrame): DataFrame containing flight data with required columns:</span>
<span class="sd">                &#39;alt_m&#39;, &#39;latitude&#39;, &#39;longitude&#39;, &#39;phase&#39;, &#39;roll_deg&#39;, &#39;pitch_deg&#39;,</span>
<span class="sd">                &#39;bearing_deg&#39;, &#39;speed_ms&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None: Displays an interactive 3D plot of the flight path.</span>

<span class="sd">        Explanation:</span>
<span class="sd">            - Uses scatter3d with lines and markers colored by altitude.</span>
<span class="sd">            - Normalizes axis scales to maintain aspect ratio between lat/lon.</span>
<span class="sd">            - Provides detailed hover info for each point including flight phase and attitudes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">required_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;alt_m&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;phase&#39;</span><span class="p">,</span> <span class="s1">&#39;roll_deg&#39;</span><span class="p">,</span> <span class="s1">&#39;pitch_deg&#39;</span><span class="p">,</span> <span class="s1">&#39;bearing_deg&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;speed_ms&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">required_columns</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DataFrame must contain </span><span class="si">{</span><span class="n">required_columns</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span>
            <span class="n">z</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;alt_m&#39;</span><span class="p">],</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines+markers&#39;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;alt_m&#39;</span><span class="p">],</span>  <span class="c1"># color based on altitude</span>
                <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;Viridis&#39;</span><span class="p">,</span>
                <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span>
            <span class="p">),</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">2</span>
            <span class="p">),</span>
            <span class="n">customdata</span><span class="o">=</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;phase&#39;</span><span class="p">,</span> <span class="s1">&#39;roll_deg&#39;</span><span class="p">,</span> <span class="s1">&#39;pitch_deg&#39;</span><span class="p">,</span> <span class="s1">&#39;bearing_deg&#39;</span><span class="p">,</span> <span class="s1">&#39;speed_ms&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">hovertemplate</span><span class="o">=</span><span class="p">(</span>
                    <span class="s2">&quot;Longitude: %</span><span class="si">{x}</span><span class="s2">&lt;br&gt;&quot;</span> <span class="o">+</span>
                    <span class="s2">&quot;Latitude: %</span><span class="si">{y}</span><span class="s2">&lt;br&gt;&quot;</span> <span class="o">+</span>
                    <span class="s2">&quot;Altitude: %</span><span class="si">{z}</span><span class="s2"> m&lt;br&gt;&quot;</span> <span class="o">+</span>
                    <span class="s2">&quot;Phase: %</span><span class="si">{customdata[0]}</span><span class="s2">&lt;br&gt;&quot;</span> <span class="o">+</span>
                    <span class="s2">&quot;Roll: %</span><span class="si">{customdata[1]}</span><span class="s2">°&lt;br&gt;&quot;</span> <span class="o">+</span>
                    <span class="s2">&quot;Pitch: %</span><span class="si">{customdata[2]}</span><span class="s2">°&lt;br&gt;&quot;</span> <span class="o">+</span>
                    <span class="s2">&quot;Bearing: %</span><span class="si">{customdata[3]}</span><span class="s2">°&lt;br&gt;&quot;</span> <span class="o">+</span>
                    <span class="s2">&quot;Speed: %</span><span class="si">{customdata[4]}</span><span class="s2"> m/s&lt;br&gt;&quot;</span> <span class="o">+</span>
                    <span class="s2">&quot;&lt;extra&gt;&lt;/extra&gt;&quot;</span>
            <span class="p">)</span>
        <span class="p">)])</span>

        <span class="c1"># Calcul des plages</span>
        <span class="n">delta_x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        <span class="n">delta_y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        <span class="n">delta_z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;alt_m&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;alt_m&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>

        <span class="c1"># Normalisation pour avoir une base XY à échelle 1:1</span>
        <span class="n">max_base</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">delta_x</span><span class="p">,</span> <span class="n">delta_y</span><span class="p">)</span>
        <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">delta_x</span> <span class="o">/</span> <span class="n">max_base</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">delta_y</span> <span class="o">/</span> <span class="n">max_base</span><span class="p">,</span>
            <span class="n">z</span><span class="o">=</span><span class="mf">0.05</span>  <span class="c1"># ou fixe à 0.5 si trop grand</span>
        <span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s1">&#39;3D Flight Path&#39;</span><span class="p">,</span>
            <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;Longitude&#39;</span><span class="p">,</span>
                <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Latitude&#39;</span><span class="p">,</span>
                <span class="n">zaxis_title</span><span class="o">=</span><span class="s1">&#39;Altitude (m)&#39;</span><span class="p">,</span>
                <span class="n">aspectmode</span><span class="o">=</span><span class="s1">&#39;manual&#39;</span><span class="p">,</span>
                <span class="n">aspectratio</span><span class="o">=</span><span class="n">aspect_ratio</span>
            <span class="p">),</span>
            <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="plane_trajectory.calculate_trajectory">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.plane_trajectory.calculate_trajectory">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_3D</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the full flight trajectory by simulating takeoff, climb, cruise, turns,</span>
<span class="sd">        and descent phases, aggregating the results into a comprehensive flight log.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            dt (float): Time step in seconds for simulation steps.</span>
<span class="sd">            plot (bool): If True, generates 2D plots of altitude, speed, and pitch.</span>
<span class="sd">            plot_3D (bool): If True, generates a 3D interactive plot of the flight path.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Combined DataFrame logging aircraft state through all flight phases,</span>
<span class="sd">            including positions, speeds, attitudes, and flight phases.</span>

<span class="sd">        Explanation:</span>
<span class="sd">            - Simulates takeoff and climb if climb enabled.</span>
<span class="sd">            - Simulates turns and cruise legs between waypoints.</span>
<span class="sd">            - Optionally simulates descent and landing.</span>
<span class="sd">            - Supports visual output for deeper insight into trajectory and flight dynamics.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_climb</span><span class="p">:</span>
            <span class="n">trajectory_log_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate_takeoff_and_climb</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">pitch_threshold</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
            <span class="n">turn_log_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">perform_turn_to_next_waypoint</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
            <span class="n">trajectory_log_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">trajectory_log_df</span><span class="p">,</span> <span class="n">turn_log_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trajectory_log_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span>
                <span class="s2">&quot;plane_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">flight_id</span><span class="p">,</span>
                <span class="s2">&quot;time_s&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="s2">&quot;speed_ms&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span>
                <span class="s2">&quot;alt_m&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span>
                <span class="s2">&quot;roll_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span><span class="p">,</span>
                <span class="s2">&quot;pitch_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span>
                <span class="s2">&quot;yaw_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaw</span><span class="p">,</span>
                <span class="s2">&quot;bearing_deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bearing</span><span class="p">,</span>
                <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span>
                <span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="s2">&quot;initial State&quot;</span><span class="p">,</span>
                <span class="s2">&quot;plane_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_type</span>
            <span class="p">}])</span>
            <span class="n">trajectory_log_df</span> <span class="o">=</span> <span class="n">trajectory_log_df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df_col_names</span><span class="p">)</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Calculating for waypoint </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span><span class="si">}</span><span class="s2"> coords: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_waypoint_index</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">cruise_log_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate_cruise_to_waypoint</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
            <span class="n">trajectory_log_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">trajectory_log_df</span><span class="p">,</span> <span class="n">cruise_log_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">turn_log_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">perform_turn_to_next_waypoint</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
            <span class="n">trajectory_log_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">trajectory_log_df</span><span class="p">,</span> <span class="n">turn_log_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_descent</span><span class="p">:</span>
            <span class="n">descent_log_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cruise_to_destination</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
            <span class="n">trajectory_log_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">trajectory_log_df</span><span class="p">,</span> <span class="n">descent_log_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cruise_log_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate_cruise_to_waypoint</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
            <span class="n">trajectory_log_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">trajectory_log_df</span><span class="p">,</span> <span class="n">cruise_log_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">trajectory_log_df</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot_3D</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_3d_flight_path</span><span class="p">(</span><span class="n">trajectory_log_df</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">trajectory_log_df</span></div>
</div>


<div class="viewcode-block" id="haversine">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.haversine">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">haversine</span><span class="p">(</span><span class="n">lon1</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">lat2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the great-circle distance between two points</span>
<span class="sd">    on the Earth specified by longitude and latitude.</span>
<span class="sd">    Returns distance in kilometers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lon1</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">lat2</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">,</span> <span class="p">[</span><span class="n">lon1</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">lat2</span><span class="p">])</span>
    <span class="n">dlon</span> <span class="o">=</span> <span class="n">lon2</span> <span class="o">-</span> <span class="n">lon1</span>
    <span class="n">dlat</span> <span class="o">=</span> <span class="n">lat2</span> <span class="o">-</span> <span class="n">lat1</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dlat</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
        <span class="n">dlon</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">asin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
    <span class="n">R</span> <span class="o">=</span> <span class="mf">6371.0</span>
    <span class="k">return</span> <span class="n">R</span> <span class="o">*</span> <span class="n">c</span></div>



<div class="viewcode-block" id="FlightTrajectoryWorker">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FlightTrajectoryWorker</span><span class="p">(</span><span class="n">PolarsWorker</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class derived from AgiDataWorker&quot;&quot;&quot;</span>
    <span class="n">pool_vars</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="FlightTrajectoryWorker.start">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.start">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">global_vars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pool_vars</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pool_vars</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span>
        <span class="n">global_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool_vars</span>
        <span class="n">data_out</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;data_out&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">data_out</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">onerror</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">onerror</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">data_out</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error removing directory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;from: </span><span class="si">{</span><span class="vm">__file__</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="FlightTrajectoryWorker.work_init">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.work_init">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">work_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize work by reading from shared space.&quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">global_vars</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="FlightTrajectoryWorker.pool_init">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.pool_init">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">pool_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">worker_vars</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the pool with worker variables.</span>

<span class="sd">        Args:</span>
<span class="sd">            worker_vars (dict): Variables specific to the worker.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">global_vars</span>
        <span class="n">global_vars</span> <span class="o">=</span> <span class="n">worker_vars</span></div>


<div class="viewcode-block" id="FlightTrajectoryWorker.work_pool">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.work_pool">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">work_pool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse IVQ log files.</span>

<span class="sd">        Args:</span>
<span class="sd">            file (str): The log file to parse.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pl.DataFrame: Parsed data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">global_vars</span>
        <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span>
        <span class="n">file</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">data_dir_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;data_dir&#39;</span><span class="p">])</span>
        <span class="n">expanded_data_dir_path</span> <span class="o">=</span> <span class="n">data_dir_path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
        <span class="n">full_waypoints_path</span> <span class="o">=</span> <span class="n">expanded_data_dir_path</span> <span class="o">/</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;waypoints&#39;</span><span class="p">]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">full_waypoints_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">waypoints_list</span><span class="p">:</span>
            <span class="n">list_waypoints</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">waypoints_list</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">list_waypoints</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">][</span><span class="n">file</span><span class="p">][</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">0</span>
            <span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_waypoints</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">][</span><span class="n">file</span><span class="p">][</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span>
            <span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">list_waypoints</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">][</span><span class="n">file</span><span class="p">][</span>
            <span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">plane</span> <span class="o">=</span> <span class="n">plane_trajectory</span><span class="p">(</span><span class="n">flight_id</span><span class="o">=</span><span class="n">file</span><span class="p">,</span> <span class="n">waypoints</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                <span class="n">yaw_angular_speed</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;yaw_angular_speed&#39;</span><span class="p">],</span>
                <span class="n">roll_angular_speed</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;roll_angular_speed&#39;</span><span class="p">],</span>
                <span class="n">pitch_angular_speed</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;pitch_angular_speed&#39;</span><span class="p">],</span>
                <span class="n">vehicle_acceleration</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;vehicule_acceleration&#39;</span><span class="p">],</span>
                <span class="n">max_speed</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;max_speed&#39;</span><span class="p">],</span> <span class="n">max_roll</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;max_roll&#39;</span><span class="p">],</span>
                <span class="n">max_pitch</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;max_pitch&#39;</span><span class="p">],</span> <span class="n">target_climbup_pitch</span><span class="o">=</span><span class="n">args</span><span class="p">[</span>
                <span class="s1">&#39;target_climbup_pitch&#39;</span><span class="p">],</span> <span class="n">pitch_enable_speed_ratio</span><span class="o">=</span><span class="n">args</span><span class="p">[</span>
                <span class="s1">&#39;pitch_enable_speed_ratio&#39;</span><span class="p">],</span> <span class="n">altitude_loss_speed_treshold</span><span class="o">=</span>
                <span class="n">args</span><span class="p">[</span><span class="s1">&#39;altitude_loss_speed_treshold&#39;</span><span class="p">],</span> <span class="n">descent_pitch_target</span><span class="o">=</span>
                <span class="n">args</span><span class="p">[</span><span class="s1">&#39;descent_pitch_target&#39;</span><span class="p">],</span> <span class="n">landing_pitch_target</span><span class="o">=</span><span class="n">args</span><span class="p">[</span>
                <span class="s1">&#39;landing_pitch_target&#39;</span><span class="p">],</span> <span class="n">cruising_pitch_max</span><span class="o">=</span><span class="n">args</span><span class="p">[</span>
                <span class="s1">&#39;cruising_pitch_max&#39;</span><span class="p">],</span> <span class="n">descent_alt_treshold_landing</span><span class="o">=</span><span class="n">args</span><span class="p">[</span>
                <span class="s1">&#39;descent_alt_treshold_landing&#39;</span><span class="p">],</span>
                <span class="n">max_speed_ratio_while_turining</span><span class="o">=</span><span class="n">args</span><span class="p">[</span>
                <span class="s1">&#39;max_speed_ratio_while_turining&#39;</span><span class="p">],</span> <span class="n">enable_climb</span><span class="o">=</span><span class="n">args</span><span class="p">[</span>
                <span class="s1">&#39;enable_climb&#39;</span><span class="p">],</span> <span class="n">enable_descent</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;enable_descent&#39;</span><span class="p">],</span>
                <span class="n">default_alt_value</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;default_alt_value&#39;</span><span class="p">],</span> <span class="n">plane_type</span><span class="o">=</span>
                <span class="n">args</span><span class="p">[</span><span class="s1">&#39;plane_type&#39;</span><span class="p">])</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">plane</span><span class="o">.</span><span class="n">calculate_trajectory</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">col_name</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">col_name</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;time_s&#39;</span><span class="p">)</span>
            <span class="n">col_name</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;time_s&#39;</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">col_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;sat&quot;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;plane_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;roll_deg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;pitch_deg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;bearing_deg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;yaw_deg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Initialization failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="FlightTrajectoryWorker.work_done">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.work_done">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">work_done</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">worker_df</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Concatenate dataframe if any and save the results.</span>

<span class="sd">        Args:</span>
<span class="sd">            worker_df (pl.DataFrame): Output dataframe for one plane.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">worker_df</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">worker_df</span><span class="p">[</span><span class="s1">&#39;plane_id&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;data_out&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">_%H-%M-%S&#39;</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;plane_type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s1">.csv&#39;</span>
            <span class="n">worker_df</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error saving dataframe for plane </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s1"> : </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="FlightTrajectoryWorker.stop">
<a class="viewcode-back" href="../../flight-trajectory.html#flight_trajectory_worker.flight_trajectory_worker.FlightTrajectoryWorker.stop">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Finalize the worker by listing saved dataframes.&quot;&quot;&quot;</span>
            <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="s1">&#39;**&#39;</span><span class="p">),</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="n">df_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">.(csv|parquet)$&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)]</span>
            <span class="n">n_df</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_files</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;FlightTrajectoryWorker.worker_end - </span><span class="si">{</span><span class="n">n_df</span><span class="si">}</span><span class="s1"> dataframes:&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">df_files</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">n_df</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No dataframe created&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error while trying to find dataframes: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, THALES SIX GTS France SAS.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>